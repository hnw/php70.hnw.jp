<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>mem5</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.4' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/1054.html#L18657'>mem5</a>             18657 ext/sqlite3/libsqlite/sqlite3.c } mem5;</span>
<span class='curline'><a href='../S/1054.html#L18662'>mem5</a>             18662 ext/sqlite3/libsqlite/sqlite3.c #define mem5 GLOBAL(struct Mem5Global, mem5)</span>
<span class='curline'><a href='../S/1054.html#L18668'>mem5</a>             18668 ext/sqlite3/libsqlite/sqlite3.c #define MEM5LINK(idx) ((Mem5Link *)(&amp;mem5.zPool[(idx)*mem5.szAtom]))</span>
<span class='curline'><a href='../S/1054.html#L18676'>mem5</a>             18676 ext/sqlite3/libsqlite/sqlite3.c   assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18678'>mem5</a>             18678 ext/sqlite3/libsqlite/sqlite3.c   assert( (mem5.aCtrl[i] &amp; CTRL_LOGSIZE)==iLogsize );</span>
<span class='curline'><a href='../S/1054.html#L18683'>mem5</a>             18683 ext/sqlite3/libsqlite/sqlite3.c     mem5.aiFreelist[iLogsize] = next;</span>
<span class='curline'><a href='../S/1054.html#L18698'>mem5</a>             18698 ext/sqlite3/libsqlite/sqlite3.c   assert( sqlite3_mutex_held(mem5.mutex) );</span>
<span class='curline'><a href='../S/1054.html#L18699'>mem5</a>             18699 ext/sqlite3/libsqlite/sqlite3.c   assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18701'>mem5</a>             18701 ext/sqlite3/libsqlite/sqlite3.c   assert( (mem5.aCtrl[i] &amp; CTRL_LOGSIZE)==iLogsize );</span>
<span class='curline'><a href='../S/1054.html#L18703'>mem5</a>             18703 ext/sqlite3/libsqlite/sqlite3.c   x = MEM5LINK(i)-&gt;next = mem5.aiFreelist[iLogsize];</span>
<span class='curline'><a href='../S/1054.html#L18706'>mem5</a>             18706 ext/sqlite3/libsqlite/sqlite3.c     assert( x&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18709'>mem5</a>             18709 ext/sqlite3/libsqlite/sqlite3.c   mem5.aiFreelist[iLogsize] = i;</span>
<span class='curline'><a href='../S/1054.html#L18718'>mem5</a>             18718 ext/sqlite3/libsqlite/sqlite3.c   sqlite3_mutex_enter(mem5.mutex);</span>
<span class='curline'><a href='../S/1054.html#L18721'>mem5</a>             18721 ext/sqlite3/libsqlite/sqlite3.c   sqlite3_mutex_leave(mem5.mutex);</span>
<span class='curline'><a href='../S/1054.html#L18732'>mem5</a>             18732 ext/sqlite3/libsqlite/sqlite3.c     int i = (int)(((u8 *)p-mem5.zPool)/mem5.szAtom);</span>
<span class='curline'><a href='../S/1054.html#L18733'>mem5</a>             18733 ext/sqlite3/libsqlite/sqlite3.c     assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18734'>mem5</a>             18734 ext/sqlite3/libsqlite/sqlite3.c     iSize = mem5.szAtom * (1 &lt;&lt; (mem5.aCtrl[i]&amp;CTRL_LOGSIZE));</span>
<span class='curline'><a href='../S/1054.html#L18760'>mem5</a>             18760 ext/sqlite3/libsqlite/sqlite3.c   if( (u32)nByte&gt;mem5.maxRequest ){</span>
<span class='curline'><a href='../S/1054.html#L18761'>mem5</a>             18761 ext/sqlite3/libsqlite/sqlite3.c     mem5.maxRequest = nByte;</span>
<span class='curline'><a href='../S/1054.html#L18772'>mem5</a>             18772 ext/sqlite3/libsqlite/sqlite3.c   for(iFullSz=mem5.szAtom, iLogsize=0; iFullSz&lt;nByte; iFullSz *= 2, iLogsize++){}</span>
<span class='curline'><a href='../S/1054.html#L18778'>mem5</a>             18778 ext/sqlite3/libsqlite/sqlite3.c   for(iBin=iLogsize; iBin&lt;=LOGMAX &amp;&amp; mem5.aiFreelist[iBin]&lt;0; iBin++){}</span>
<span class='curline'><a href='../S/1054.html#L18784'>mem5</a>             18784 ext/sqlite3/libsqlite/sqlite3.c   i = mem5.aiFreelist[iBin];</span>
<span class='curline'><a href='../S/1054.html#L18791'>mem5</a>             18791 ext/sqlite3/libsqlite/sqlite3.c     mem5.aCtrl[i+newSize] = CTRL_FREE | iBin;</span>
<span class='curline'><a href='../S/1054.html#L18794'>mem5</a>             18794 ext/sqlite3/libsqlite/sqlite3.c   mem5.aCtrl[i] = iLogsize;</span>
<span class='curline'><a href='../S/1054.html#L18797'>mem5</a>             18797 ext/sqlite3/libsqlite/sqlite3.c   mem5.nAlloc++;</span>
<span class='curline'><a href='../S/1054.html#L18798'>mem5</a>             18798 ext/sqlite3/libsqlite/sqlite3.c   mem5.totalAlloc += iFullSz;</span>
<span class='curline'><a href='../S/1054.html#L18799'>mem5</a>             18799 ext/sqlite3/libsqlite/sqlite3.c   mem5.totalExcess += iFullSz - nByte;</span>
<span class='curline'><a href='../S/1054.html#L18800'>mem5</a>             18800 ext/sqlite3/libsqlite/sqlite3.c   mem5.currentCount++;</span>
<span class='curline'><a href='../S/1054.html#L18801'>mem5</a>             18801 ext/sqlite3/libsqlite/sqlite3.c   mem5.currentOut += iFullSz;</span>
<span class='curline'><a href='../S/1054.html#L18802'>mem5</a>             18802 ext/sqlite3/libsqlite/sqlite3.c   if( mem5.maxCount&lt;mem5.currentCount ) mem5.maxCount = mem5.currentCount;</span>
<span class='curline'><a href='../S/1054.html#L18803'>mem5</a>             18803 ext/sqlite3/libsqlite/sqlite3.c   if( mem5.maxOut&lt;mem5.currentOut ) mem5.maxOut = mem5.currentOut;</span>
<span class='curline'><a href='../S/1054.html#L18808'>mem5</a>             18808 ext/sqlite3/libsqlite/sqlite3.c   memset(&amp;mem5.zPool[i*mem5.szAtom], 0xAA, iFullSz);</span>
<span class='curline'><a href='../S/1054.html#L18812'>mem5</a>             18812 ext/sqlite3/libsqlite/sqlite3.c   return (void*)&amp;mem5.zPool[i*mem5.szAtom];</span>
<span class='curline'><a href='../S/1054.html#L18825'>mem5</a>             18825 ext/sqlite3/libsqlite/sqlite3.c   iBlock = (int)(((u8 *)pOld-mem5.zPool)/mem5.szAtom);</span>
<span class='curline'><a href='../S/1054.html#L18828'>mem5</a>             18828 ext/sqlite3/libsqlite/sqlite3.c   assert( iBlock&gt;=0 &amp;&amp; iBlock&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18829'>mem5</a>             18829 ext/sqlite3/libsqlite/sqlite3.c   assert( ((u8 *)pOld-mem5.zPool)%mem5.szAtom==0 );</span>
<span class='curline'><a href='../S/1054.html#L18830'>mem5</a>             18830 ext/sqlite3/libsqlite/sqlite3.c   assert( (mem5.aCtrl[iBlock] &amp; CTRL_FREE)==0 );</span>
<span class='curline'><a href='../S/1054.html#L18832'>mem5</a>             18832 ext/sqlite3/libsqlite/sqlite3.c   iLogsize = mem5.aCtrl[iBlock] &amp; CTRL_LOGSIZE;</span>
<span class='curline'><a href='../S/1054.html#L18834'>mem5</a>             18834 ext/sqlite3/libsqlite/sqlite3.c   assert( iBlock+size-1&lt;(u32)mem5.nBlock );</span>
<span class='curline'><a href='../S/1054.html#L18836'>mem5</a>             18836 ext/sqlite3/libsqlite/sqlite3.c   mem5.aCtrl[iBlock] |= CTRL_FREE;</span>
<span class='curline'><a href='../S/1054.html#L18837'>mem5</a>             18837 ext/sqlite3/libsqlite/sqlite3.c   mem5.aCtrl[iBlock+size-1] |= CTRL_FREE;</span>
<span class='curline'><a href='../S/1054.html#L18838'>mem5</a>             18838 ext/sqlite3/libsqlite/sqlite3.c   assert( mem5.currentCount&gt;0 );</span>
<span class='curline'><a href='../S/1054.html#L18839'>mem5</a>             18839 ext/sqlite3/libsqlite/sqlite3.c   assert( mem5.currentOut&gt;=(size*mem5.szAtom) );</span>
<span class='curline'><a href='../S/1054.html#L18840'>mem5</a>             18840 ext/sqlite3/libsqlite/sqlite3.c   mem5.currentCount--;</span>
<span class='curline'><a href='../S/1054.html#L18841'>mem5</a>             18841 ext/sqlite3/libsqlite/sqlite3.c   mem5.currentOut -= size*mem5.szAtom;</span>
<span class='curline'><a href='../S/1054.html#L18842'>mem5</a>             18842 ext/sqlite3/libsqlite/sqlite3.c   assert( mem5.currentOut&gt;0 || mem5.currentCount==0 );</span>
<span class='curline'><a href='../S/1054.html#L18843'>mem5</a>             18843 ext/sqlite3/libsqlite/sqlite3.c   assert( mem5.currentCount&gt;0 || mem5.currentOut==0 );</span>
<span class='curline'><a href='../S/1054.html#L18845'>mem5</a>             18845 ext/sqlite3/libsqlite/sqlite3.c   mem5.aCtrl[iBlock] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/1054.html#L18854'>mem5</a>             18854 ext/sqlite3/libsqlite/sqlite3.c     if( (iBuddy+(1&lt;&lt;iLogsize))&gt;mem5.nBlock ) break;</span>
<span class='curline'><a href='../S/1054.html#L18855'>mem5</a>             18855 ext/sqlite3/libsqlite/sqlite3.c     if( mem5.aCtrl[iBuddy]!=(CTRL_FREE | iLogsize) ) break;</span>
<span class='curline'><a href='../S/1054.html#L18859'>mem5</a>             18859 ext/sqlite3/libsqlite/sqlite3.c       mem5.aCtrl[iBuddy] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/1054.html#L18860'>mem5</a>             18860 ext/sqlite3/libsqlite/sqlite3.c       mem5.aCtrl[iBlock] = 0;</span>
<span class='curline'><a href='../S/1054.html#L18863'>mem5</a>             18863 ext/sqlite3/libsqlite/sqlite3.c       mem5.aCtrl[iBlock] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/1054.html#L18864'>mem5</a>             18864 ext/sqlite3/libsqlite/sqlite3.c       mem5.aCtrl[iBuddy] = 0;</span>
<span class='curline'><a href='../S/1054.html#L18872'>mem5</a>             18872 ext/sqlite3/libsqlite/sqlite3.c   memset(&amp;mem5.zPool[iBlock*mem5.szAtom], 0x55, size);</span>
<span class='curline'><a href='../S/1054.html#L18951'>mem5</a>             18951 ext/sqlite3/libsqlite/sqlite3.c   for(iFullSz=mem5.szAtom; iFullSz&lt;n; iFullSz *= 2);</span>
<span class='curline'><a href='../S/1054.html#L18987'>mem5</a>             18987 ext/sqlite3/libsqlite/sqlite3.c   mem5.mutex = 0;</span>
<span class='curline'><a href='../S/1054.html#L19000'>mem5</a>             19000 ext/sqlite3/libsqlite/sqlite3.c   mem5.szAtom = (1&lt;&lt;nMinLog);</span>
<span class='curline'><a href='../S/1054.html#L19001'>mem5</a>             19001 ext/sqlite3/libsqlite/sqlite3.c   while( (int)sizeof(Mem5Link)&gt;mem5.szAtom ){</span>
<span class='curline'><a href='../S/1054.html#L19002'>mem5</a>             19002 ext/sqlite3/libsqlite/sqlite3.c     mem5.szAtom = mem5.szAtom &lt;&lt; 1;</span>
<span class='curline'><a href='../S/1054.html#L19005'>mem5</a>             19005 ext/sqlite3/libsqlite/sqlite3.c   mem5.nBlock = (nByte / (mem5.szAtom+sizeof(u8)));</span>
<span class='curline'><a href='../S/1054.html#L19006'>mem5</a>             19006 ext/sqlite3/libsqlite/sqlite3.c   mem5.zPool = zByte;</span>
<span class='curline'><a href='../S/1054.html#L19007'>mem5</a>             19007 ext/sqlite3/libsqlite/sqlite3.c   mem5.aCtrl = (u8 *)&amp;mem5.zPool[mem5.nBlock*mem5.szAtom];</span>
<span class='curline'><a href='../S/1054.html#L19010'>mem5</a>             19010 ext/sqlite3/libsqlite/sqlite3.c     mem5.aiFreelist[ii] = -1;</span>
<span class='curline'><a href='../S/1054.html#L19016'>mem5</a>             19016 ext/sqlite3/libsqlite/sqlite3.c     if( (iOffset+nAlloc)&lt;=mem5.nBlock ){</span>
<span class='curline'><a href='../S/1054.html#L19017'>mem5</a>             19017 ext/sqlite3/libsqlite/sqlite3.c       mem5.aCtrl[iOffset] = ii | CTRL_FREE;</span>
<span class='curline'><a href='../S/1054.html#L19021'>mem5</a>             19021 ext/sqlite3/libsqlite/sqlite3.c     assert((iOffset+nAlloc)&gt;mem5.nBlock);</span>
<span class='curline'><a href='../S/1054.html#L19026'>mem5</a>             19026 ext/sqlite3/libsqlite/sqlite3.c     mem5.mutex = sqlite3MutexAlloc(SQLITE_MUTEX_STATIC_MEM);</span>
<span class='curline'><a href='../S/1054.html#L19037'>mem5</a>             19037 ext/sqlite3/libsqlite/sqlite3.c   mem5.mutex = 0;</span>
<span class='curline'><a href='../S/1054.html#L19062'>mem5</a>             19062 ext/sqlite3/libsqlite/sqlite3.c   nMinLog = memsys5Log(mem5.szAtom);</span>
<span class='curline'><a href='../S/1054.html#L19064'>mem5</a>             19064 ext/sqlite3/libsqlite/sqlite3.c     for(n=0, j=mem5.aiFreelist[i]; j&gt;=0; j = MEM5LINK(j)-&gt;next, n++){}</span>
<span class='curline'><a href='../S/1054.html#L19065'>mem5</a>             19065 ext/sqlite3/libsqlite/sqlite3.c     fprintf(out, "freelist items of size %d: %d\n", mem5.szAtom &lt;&lt; i, n);</span>
<span class='curline'><a href='../S/1054.html#L19067'>mem5</a>             19067 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.nAlloc       = %llu\n", mem5.nAlloc);</span>
<span class='curline'><a href='../S/1054.html#L19068'>mem5</a>             19068 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.totalAlloc   = %llu\n", mem5.totalAlloc);</span>
<span class='curline'><a href='../S/1054.html#L19069'>mem5</a>             19069 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.totalExcess  = %llu\n", mem5.totalExcess);</span>
<span class='curline'><a href='../S/1054.html#L19070'>mem5</a>             19070 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.currentOut   = %u\n", mem5.currentOut);</span>
<span class='curline'><a href='../S/1054.html#L19071'>mem5</a>             19071 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.currentCount = %u\n", mem5.currentCount);</span>
<span class='curline'><a href='../S/1054.html#L19072'>mem5</a>             19072 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.maxOut       = %u\n", mem5.maxOut);</span>
<span class='curline'><a href='../S/1054.html#L19073'>mem5</a>             19073 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.maxCount     = %u\n", mem5.maxCount);</span>
<span class='curline'><a href='../S/1054.html#L19074'>mem5</a>             19074 ext/sqlite3/libsqlite/sqlite3.c   fprintf(out, "mem5.maxRequest   = %u\n", mem5.maxRequest);</span>
</pre>
</body>
</html>
