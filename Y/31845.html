<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>phar</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.4' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/956.html#L25'>phar</a>               25 ext/phar/dirstream.c void phar_dostat(phar_archive_data *phar, phar_entry_info *data, php_stream_statbuf *ssb, zend_bool is_dir);</span>
<span class='curline'><a href='../S/956.html#L311'>phar</a>              311 ext/phar/dirstream.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/956.html#L342'>phar</a>              342 ext/phar/dirstream.c 	if (FAILURE == phar_get_archive(&amp;phar, resource-&gt;host, host_len, NULL, 0, &amp;error)) {</span>
<span class='curline'><a href='../S/956.html#L360'>phar</a>              360 ext/phar/dirstream.c 		ret = phar_make_dirstream(internal_file, &amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/956.html#L365'>phar</a>              365 ext/phar/dirstream.c 	if (!phar-&gt;manifest.u.flags) {</span>
<span class='curline'><a href='../S/956.html#L370'>phar</a>              370 ext/phar/dirstream.c 	if (NULL != (entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, internal_file, strlen(internal_file))) &amp;&amp; !entry-&gt;is_dir) {</span>
<span class='curline'><a href='../S/956.html#L380'>phar</a>              380 ext/phar/dirstream.c 		return phar_make_dirstream(internal_file, &amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/956.html#L385'>phar</a>              385 ext/phar/dirstream.c 		zend_hash_internal_pointer_reset(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/956.html#L386'>phar</a>              386 ext/phar/dirstream.c 		while (FAILURE != zend_hash_has_more_elements(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/956.html#L388'>phar</a>              388 ext/phar/dirstream.c 					zend_hash_get_current_key(&amp;phar-&gt;manifest, &amp;str_key, &amp;unused)) {</span>
<span class='curline'><a href='../S/956.html#L394'>phar</a>              394 ext/phar/dirstream.c 					return phar_make_dirstream(internal_file, &amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/956.html#L398'>phar</a>              398 ext/phar/dirstream.c 			if (SUCCESS != zend_hash_move_forward(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/956.html#L415'>phar</a>              415 ext/phar/dirstream.c 	phar_archive_data *phar = NULL;</span>
<span class='curline'><a href='../S/956.html#L427'>phar</a>              427 ext/phar/dirstream.c 	if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/956.html#L428'>phar</a>              428 ext/phar/dirstream.c 		phar = NULL;</span>
<span class='curline'><a href='../S/956.html#L434'>phar</a>              434 ext/phar/dirstream.c 	if (PHAR_G(readonly) &amp;&amp; (!phar || !phar-&gt;is_data)) {</span>
<span class='curline'><a href='../S/956.html#L458'>phar</a>              458 ext/phar/dirstream.c 	if (FAILURE == phar_get_archive(&amp;phar, resource-&gt;host, host_len, NULL, 0, &amp;error)) {</span>
<span class='curline'><a href='../S/956.html#L465'>phar</a>              465 ext/phar/dirstream.c 	if ((e = phar_get_entry_info_dir(phar, resource-&gt;path + 1, strlen(resource-&gt;path + 1), 2, &amp;error, 1))) {</span>
<span class='curline'><a href='../S/956.html#L483'>phar</a>              483 ext/phar/dirstream.c 	if (phar_get_entry_info_dir(phar, resource-&gt;path + 1, strlen(resource-&gt;path + 1), 0, &amp;error, 1)) {</span>
<span class='curline'><a href='../S/956.html#L500'>phar</a>              500 ext/phar/dirstream.c 	if (phar-&gt;is_zip) {</span>
<span class='curline'><a href='../S/956.html#L506'>phar</a>              506 ext/phar/dirstream.c 	if (phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/956.html#L514'>phar</a>              514 ext/phar/dirstream.c 	entry.phar = phar;</span>
<span class='curline'><a href='../S/956.html#L520'>phar</a>              520 ext/phar/dirstream.c 	if (NULL == zend_hash_str_add_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/956.html#L521'>phar</a>              521 ext/phar/dirstream.c 		php_stream_wrapper_log_error(wrapper, options, "phar error: cannot create directory \"%s\" in phar \"%s\", adding to manifest failed", entry.filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/956.html#L527'>phar</a>              527 ext/phar/dirstream.c 	phar_flush(phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/956.html#L530'>phar</a>              530 ext/phar/dirstream.c 		php_stream_wrapper_log_error(wrapper, options, "phar error: cannot create directory \"%s\" in phar \"%s\", %s", entry.filename, phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/956.html#L531'>phar</a>              531 ext/phar/dirstream.c 		zend_hash_str_del(&amp;phar-&gt;manifest, entry.filename, entry.filename_len);</span>
<span class='curline'><a href='../S/956.html#L536'>phar</a>              536 ext/phar/dirstream.c 	phar_add_virtual_dirs(phar, entry.filename, entry.filename_len);</span>
<span class='curline'><a href='../S/956.html#L547'>phar</a>              547 ext/phar/dirstream.c 	phar_archive_data *phar = NULL;</span>
<span class='curline'><a href='../S/956.html#L562'>phar</a>              562 ext/phar/dirstream.c 	if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/956.html#L563'>phar</a>              563 ext/phar/dirstream.c 		phar = NULL;</span>
<span class='curline'><a href='../S/956.html#L569'>phar</a>              569 ext/phar/dirstream.c 	if (PHAR_G(readonly) &amp;&amp; (!phar || !phar-&gt;is_data)) {</span>
<span class='curline'><a href='../S/956.html#L593'>phar</a>              593 ext/phar/dirstream.c 	if (FAILURE == phar_get_archive(&amp;phar, resource-&gt;host, host_len, NULL, 0, &amp;error)) {</span>
<span class='curline'><a href='../S/956.html#L602'>phar</a>              602 ext/phar/dirstream.c 	if (!(entry = phar_get_entry_info_dir(phar, resource-&gt;path + 1, path_len, 2, &amp;error, 1))) {</span>
<span class='curline'><a href='../S/956.html#L614'>phar</a>              614 ext/phar/dirstream.c 		for (zend_hash_internal_pointer_reset(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/956.html#L615'>phar</a>              615 ext/phar/dirstream.c 			HASH_KEY_NON_EXISTENT != zend_hash_get_current_key(&amp;phar-&gt;manifest, &amp;str_key, &amp;unused);</span>
<span class='curline'><a href='../S/956.html#L616'>phar</a>              616 ext/phar/dirstream.c 			zend_hash_move_forward(&amp;phar-&gt;manifest)</span>
<span class='curline'><a href='../S/956.html#L631'>phar</a>              631 ext/phar/dirstream.c 		for (zend_hash_internal_pointer_reset(&amp;phar-&gt;virtual_dirs);</span>
<span class='curline'><a href='../S/956.html#L632'>phar</a>              632 ext/phar/dirstream.c 			HASH_KEY_NON_EXISTENT != zend_hash_get_current_key(&amp;phar-&gt;virtual_dirs, &amp;str_key, &amp;unused);</span>
<span class='curline'><a href='../S/956.html#L633'>phar</a>              633 ext/phar/dirstream.c 			zend_hash_move_forward(&amp;phar-&gt;virtual_dirs)) {</span>
<span class='curline'><a href='../S/956.html#L650'>phar</a>              650 ext/phar/dirstream.c 		zend_hash_str_del(&amp;phar-&gt;virtual_dirs, resource-&gt;path+1, path_len);</span>
<span class='curline'><a href='../S/956.html#L656'>phar</a>              656 ext/phar/dirstream.c 		phar_flush(phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/956.html#L659'>phar</a>              659 ext/phar/dirstream.c 			php_stream_wrapper_log_error(wrapper, options, "phar error: cannot remove directory \"%s\" in phar \"%s\", %s", entry-&gt;filename, phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/958.html#L133'>phar</a>              133 ext/phar/func_interceptors.c 			phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L147'>phar</a>              147 ext/phar/func_interceptors.c 			if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L163'>phar</a>              163 ext/phar/func_interceptors.c 					if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1)) {</span>
<span class='curline'><a href='../S/958.html#L171'>phar</a>              171 ext/phar/func_interceptors.c 					if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry, entry_len)) {</span>
<span class='curline'><a href='../S/958.html#L255'>phar</a>              255 ext/phar/func_interceptors.c 		phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L271'>phar</a>              271 ext/phar/func_interceptors.c 		if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L286'>phar</a>              286 ext/phar/func_interceptors.c 				if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1)) {</span>
<span class='curline'><a href='../S/958.html#L294'>phar</a>              294 ext/phar/func_interceptors.c 				if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry, entry_len)) {</span>
<span class='curline'><a href='../S/958.html#L356'>phar</a>              356 ext/phar/func_interceptors.c 		phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L372'>phar</a>              372 ext/phar/func_interceptors.c 		if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L387'>phar</a>              387 ext/phar/func_interceptors.c 				if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1)) {</span>
<span class='curline'><a href='../S/958.html#L395'>phar</a>              395 ext/phar/func_interceptors.c 				if (!zend_hash_str_exists(&amp;(phar-&gt;manifest), entry, entry_len)) {</span>
<span class='curline'><a href='../S/958.html#L619'>phar</a>              619 ext/phar/func_interceptors.c 		phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L636'>phar</a>              636 ext/phar/func_interceptors.c 			phar = PHAR_G(last_phar);</span>
<span class='curline'><a href='../S/958.html#L645'>phar</a>              645 ext/phar/func_interceptors.c 			if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L653'>phar</a>              653 ext/phar/func_interceptors.c 				if (NULL != (data = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1))) {</span>
<span class='curline'><a href='../S/958.html#L659'>phar</a>              659 ext/phar/func_interceptors.c 			if (NULL != (data = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry, entry_len))) {</span>
<span class='curline'><a href='../S/958.html#L663'>phar</a>              663 ext/phar/func_interceptors.c 			if (zend_hash_str_exists(&amp;(phar-&gt;virtual_dirs), entry, entry_len)) {</span>
<span class='curline'><a href='../S/958.html#L673'>phar</a>              673 ext/phar/func_interceptors.c 				sb.st_mtime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L674'>phar</a>              674 ext/phar/func_interceptors.c 				sb.st_atime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L675'>phar</a>              675 ext/phar/func_interceptors.c 				sb.st_ctime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L677'>phar</a>              677 ext/phar/func_interceptors.c 				sb.st_mtime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L678'>phar</a>              678 ext/phar/func_interceptors.c 				sb.st_atime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L679'>phar</a>              679 ext/phar/func_interceptors.c 				sb.st_ctime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L697'>phar</a>              697 ext/phar/func_interceptors.c 				if (NULL != (data = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1))) {</span>
<span class='curline'><a href='../S/958.html#L707'>phar</a>              707 ext/phar/func_interceptors.c 				if (zend_hash_str_exists(&amp;(phar-&gt;virtual_dirs), entry + 1, entry_len - 1)) {</span>
<span class='curline'><a href='../S/958.html#L719'>phar</a>              719 ext/phar/func_interceptors.c 					sb.st_mtime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L720'>phar</a>              720 ext/phar/func_interceptors.c 					sb.st_atime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L721'>phar</a>              721 ext/phar/func_interceptors.c 					sb.st_ctime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L723'>phar</a>              723 ext/phar/func_interceptors.c 					sb.st_mtime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L724'>phar</a>              724 ext/phar/func_interceptors.c 					sb.st_atime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L725'>phar</a>              725 ext/phar/func_interceptors.c 					sb.st_ctime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/958.html#L779'>phar</a>              779 ext/phar/func_interceptors.c 			if (!phar-&gt;is_writeable) {</span>
<span class='curline'><a href='../S/958.html#L921'>phar</a>              921 ext/phar/func_interceptors.c 			phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L928'>phar</a>              928 ext/phar/func_interceptors.c 			if (SUCCESS == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L933'>phar</a>              933 ext/phar/func_interceptors.c 					if (NULL != (etemp = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1))) {</span>
<span class='curline'><a href='../S/958.html#L941'>phar</a>              941 ext/phar/func_interceptors.c 					if (NULL != (etemp = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry, entry_len))) {</span>
<span class='curline'><a href='../S/958.html#L988'>phar</a>              988 ext/phar/func_interceptors.c 			phar_archive_data *phar;</span>
<span class='curline'><a href='../S/958.html#L995'>phar</a>              995 ext/phar/func_interceptors.c 			if (SUCCESS == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/958.html#L1000'>phar</a>             1000 ext/phar/func_interceptors.c 					if (NULL != (etemp = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry + 1, entry_len - 1))) {</span>
<span class='curline'><a href='../S/958.html#L1008'>phar</a>             1008 ext/phar/func_interceptors.c 					if (NULL != (etemp = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), entry, entry_len))) {</span>
<span class='curline'><a href='../S/960.html#L29'>phar</a>               29 ext/phar/phar.c ZEND_DECLARE_MODULE_GLOBALS(phar)</span>
<span class='curline'><a href='../S/960.html#L38'>phar</a>               38 ext/phar/phar.c 	phar_archive_data *phar = (phar_archive_data *)Z_PTR_P(zv);</span>
<span class='curline'><a href='../S/960.html#L40'>phar</a>               40 ext/phar/phar.c 	if (!phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/960.html#L41'>phar</a>               41 ext/phar/phar.c 		phar-&gt;is_writeable = !keep;</span>
<span class='curline'><a href='../S/960.html#L105'>phar</a>              105 ext/phar/phar.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/960.html#L138'>phar</a>              138 ext/phar/phar.c 			if (SUCCESS == phar_open_from_filename(key, end - key, NULL, 0, 0, &amp;phar, NULL)) {</span>
<span class='curline'><a href='../S/960.html#L140'>phar</a>              140 ext/phar/phar.c 				phar-&gt;phar_pos = i++;</span>
<span class='curline'><a href='../S/960.html#L141'>phar</a>              141 ext/phar/phar.c 				php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L142'>phar</a>              142 ext/phar/phar.c 				phar-&gt;fp = NULL;</span>
<span class='curline'><a href='../S/960.html#L161'>phar</a>              161 ext/phar/phar.c 			if (SUCCESS == phar_open_from_filename(key, strlen(key), NULL, 0, 0, &amp;phar, NULL)) {</span>
<span class='curline'><a href='../S/960.html#L206'>phar</a>              206 ext/phar/phar.c void phar_destroy_phar_data(phar_archive_data *phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L208'>phar</a>              208 ext/phar/phar.c 	if (phar-&gt;alias &amp;&amp; phar-&gt;alias != phar-&gt;fname) {</span>
<span class='curline'><a href='../S/960.html#L209'>phar</a>              209 ext/phar/phar.c 		pefree(phar-&gt;alias, phar-&gt;is_persistent);</span>
<span class='curline'><a href='../S/960.html#L210'>phar</a>              210 ext/phar/phar.c 		phar-&gt;alias = NULL;</span>
<span class='curline'><a href='../S/960.html#L213'>phar</a>              213 ext/phar/phar.c 	if (phar-&gt;fname) {</span>
<span class='curline'><a href='../S/960.html#L214'>phar</a>              214 ext/phar/phar.c 		pefree(phar-&gt;fname, phar-&gt;is_persistent);</span>
<span class='curline'><a href='../S/960.html#L215'>phar</a>              215 ext/phar/phar.c 		phar-&gt;fname = NULL;</span>
<span class='curline'><a href='../S/960.html#L218'>phar</a>              218 ext/phar/phar.c 	if (phar-&gt;signature) {</span>
<span class='curline'><a href='../S/960.html#L219'>phar</a>              219 ext/phar/phar.c 		pefree(phar-&gt;signature, phar-&gt;is_persistent);</span>
<span class='curline'><a href='../S/960.html#L220'>phar</a>              220 ext/phar/phar.c 		phar-&gt;signature = NULL;</span>
<span class='curline'><a href='../S/960.html#L223'>phar</a>              223 ext/phar/phar.c 	if (phar-&gt;manifest.u.flags) {</span>
<span class='curline'><a href='../S/960.html#L224'>phar</a>              224 ext/phar/phar.c 		zend_hash_destroy(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/960.html#L225'>phar</a>              225 ext/phar/phar.c 		phar-&gt;manifest.u.flags = 0;</span>
<span class='curline'><a href='../S/960.html#L228'>phar</a>              228 ext/phar/phar.c 	if (phar-&gt;mounted_dirs.u.flags) {</span>
<span class='curline'><a href='../S/960.html#L229'>phar</a>              229 ext/phar/phar.c 		zend_hash_destroy(&amp;phar-&gt;mounted_dirs);</span>
<span class='curline'><a href='../S/960.html#L230'>phar</a>              230 ext/phar/phar.c 		phar-&gt;mounted_dirs.u.flags = 0;</span>
<span class='curline'><a href='../S/960.html#L233'>phar</a>              233 ext/phar/phar.c 	if (phar-&gt;virtual_dirs.u.flags) {</span>
<span class='curline'><a href='../S/960.html#L234'>phar</a>              234 ext/phar/phar.c 		zend_hash_destroy(&amp;phar-&gt;virtual_dirs);</span>
<span class='curline'><a href='../S/960.html#L235'>phar</a>              235 ext/phar/phar.c 		phar-&gt;virtual_dirs.u.flags = 0;</span>
<span class='curline'><a href='../S/960.html#L238'>phar</a>              238 ext/phar/phar.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/960.html#L239'>phar</a>              239 ext/phar/phar.c 		if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/960.html#L240'>phar</a>              240 ext/phar/phar.c 			if (phar-&gt;metadata_len) {</span>
<span class='curline'><a href='../S/960.html#L242'>phar</a>              242 ext/phar/phar.c 				free(Z_PTR(phar-&gt;metadata));</span>
<span class='curline'><a href='../S/960.html#L244'>phar</a>              244 ext/phar/phar.c 				zval_internal_ptr_dtor(&amp;phar-&gt;metadata);</span>
<span class='curline'><a href='../S/960.html#L247'>phar</a>              247 ext/phar/phar.c 			zval_ptr_dtor(&amp;phar-&gt;metadata);</span>
<span class='curline'><a href='../S/960.html#L249'>phar</a>              249 ext/phar/phar.c 		phar-&gt;metadata_len = 0;</span>
<span class='curline'><a href='../S/960.html#L250'>phar</a>              250 ext/phar/phar.c 		ZVAL_UNDEF(&amp;phar-&gt;metadata);</span>
<span class='curline'><a href='../S/960.html#L253'>phar</a>              253 ext/phar/phar.c 	if (phar-&gt;fp) {</span>
<span class='curline'><a href='../S/960.html#L254'>phar</a>              254 ext/phar/phar.c 		php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L255'>phar</a>              255 ext/phar/phar.c 		phar-&gt;fp = 0;</span>
<span class='curline'><a href='../S/960.html#L258'>phar</a>              258 ext/phar/phar.c 	if (phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/960.html#L259'>phar</a>              259 ext/phar/phar.c 		php_stream_close(phar-&gt;ufp);</span>
<span class='curline'><a href='../S/960.html#L260'>phar</a>              260 ext/phar/phar.c 		phar-&gt;ufp = 0;</span>
<span class='curline'><a href='../S/960.html#L263'>phar</a>              263 ext/phar/phar.c 	pefree(phar, phar-&gt;is_persistent);</span>
<span class='curline'><a href='../S/960.html#L270'>phar</a>              270 ext/phar/phar.c int phar_archive_delref(phar_archive_data *phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L272'>phar</a>              272 ext/phar/phar.c 	if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/960.html#L276'>phar</a>              276 ext/phar/phar.c 	if (--phar-&gt;refcount &lt; 0) {</span>
<span class='curline'><a href='../S/960.html#L278'>phar</a>              278 ext/phar/phar.c 		|| zend_hash_str_del(&amp;(PHAR_G(phar_fname_map)), phar-&gt;fname, phar-&gt;fname_len) != SUCCESS) {</span>
<span class='curline'><a href='../S/960.html#L279'>phar</a>              279 ext/phar/phar.c 			phar_destroy_phar_data(phar);</span>
<span class='curline'><a href='../S/960.html#L282'>phar</a>              282 ext/phar/phar.c 	} else if (!phar-&gt;refcount) {</span>
<span class='curline'><a href='../S/960.html#L287'>phar</a>              287 ext/phar/phar.c 		if (phar-&gt;fp &amp;&amp; !(phar-&gt;flags &amp; PHAR_FILE_COMPRESSION_MASK)) {</span>
<span class='curline'><a href='../S/960.html#L292'>phar</a>              292 ext/phar/phar.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L293'>phar</a>              293 ext/phar/phar.c 			phar-&gt;fp = NULL;</span>
<span class='curline'><a href='../S/960.html#L296'>phar</a>              296 ext/phar/phar.c 		if (!zend_hash_num_elements(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/960.html#L299'>phar</a>              299 ext/phar/phar.c 			if (zend_hash_str_del(&amp;(PHAR_G(phar_fname_map)), phar-&gt;fname, phar-&gt;fname_len) != SUCCESS) {</span>
<span class='curline'><a href='../S/960.html#L300'>phar</a>              300 ext/phar/phar.c 				phar_destroy_phar_data(phar);</span>
<span class='curline'><a href='../S/960.html#L441'>phar</a>              441 ext/phar/phar.c 		if (idata-&gt;fp &amp;&amp; idata-&gt;fp != idata-&gt;phar-&gt;fp &amp;&amp; idata-&gt;fp != idata-&gt;phar-&gt;ufp &amp;&amp; idata-&gt;fp != idata-&gt;internal_file-&gt;fp) {</span>
<span class='curline'><a href='../S/960.html#L451'>phar</a>              451 ext/phar/phar.c 	phar_archive_delref(idata-&gt;phar);</span>
<span class='curline'><a href='../S/960.html#L462'>phar</a>              462 ext/phar/phar.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/960.html#L464'>phar</a>              464 ext/phar/phar.c 	phar = idata-&gt;phar;</span>
<span class='curline'><a href='../S/960.html#L467'>phar</a>              467 ext/phar/phar.c 		if (idata-&gt;fp &amp;&amp; idata-&gt;fp != idata-&gt;phar-&gt;fp &amp;&amp; idata-&gt;fp != idata-&gt;phar-&gt;ufp &amp;&amp; idata-&gt;fp != idata-&gt;internal_file-&gt;fp) {</span>
<span class='curline'><a href='../S/960.html#L470'>phar</a>              470 ext/phar/phar.c 		zend_hash_str_del(&amp;idata-&gt;phar-&gt;manifest, idata-&gt;internal_file-&gt;filename, idata-&gt;internal_file-&gt;filename_len);</span>
<span class='curline'><a href='../S/960.html#L471'>phar</a>              471 ext/phar/phar.c 		idata-&gt;phar-&gt;refcount--;</span>
<span class='curline'><a href='../S/960.html#L478'>phar</a>              478 ext/phar/phar.c 	if (!phar-&gt;donotflush) {</span>
<span class='curline'><a href='../S/960.html#L479'>phar</a>              479 ext/phar/phar.c 		phar_flush(phar, 0, 0, 0, error);</span>
<span class='curline'><a href='../S/960.html#L534'>phar</a>              534 ext/phar/phar.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/960.html#L546'>phar</a>              546 ext/phar/phar.c 	if (SUCCESS == phar_get_archive(&amp;phar, unixfname, fname_len, alias, alias_len, error)</span>
<span class='curline'><a href='../S/960.html#L547'>phar</a>              547 ext/phar/phar.c 		&amp;&amp; ((alias &amp;&amp; fname_len == phar-&gt;fname_len</span>
<span class='curline'><a href='../S/960.html#L548'>phar</a>              548 ext/phar/phar.c 		&amp;&amp; !strncmp(unixfname, phar-&gt;fname, fname_len)) || !alias)</span>
<span class='curline'><a href='../S/960.html#L553'>phar</a>              553 ext/phar/phar.c 	if (SUCCESS == phar_get_archive(&amp;phar, fname, fname_len, alias, alias_len, error)</span>
<span class='curline'><a href='../S/960.html#L554'>phar</a>              554 ext/phar/phar.c 		&amp;&amp; ((alias &amp;&amp; fname_len == phar-&gt;fname_len</span>
<span class='curline'><a href='../S/960.html#L555'>phar</a>              555 ext/phar/phar.c 		&amp;&amp; !strncmp(fname, phar-&gt;fname, fname_len)) || !alias)</span>
<span class='curline'><a href='../S/960.html#L567'>phar</a>              567 ext/phar/phar.c 			if (!phar-&gt;halt_offset &amp;&amp; !phar-&gt;is_brandnew &amp;&amp; (phar-&gt;is_tar || phar-&gt;is_zip)) {</span>
<span class='curline'><a href='../S/960.html#L568'>phar</a>              568 ext/phar/phar.c 				if (PHAR_G(readonly) &amp;&amp; NULL == (stub = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), ".phar/stub.php", sizeof(".phar/stub.php")-1))) {</span>
<span class='curline'><a href='../S/960.html#L578'>phar</a>              578 ext/phar/phar.c 			*pphar = phar;</span>
<span class='curline'><a href='../S/960.html#L590'>phar</a>              590 ext/phar/phar.c 		if (phar &amp;&amp; error &amp;&amp; !(options &amp; REPORT_ERRORS)) {</span>
<span class='curline'><a href='../S/960.html#L1055'>phar</a>             1055 ext/phar/phar.c 	entry.phar = mydata;</span>
<span class='curline'><a href='../S/960.html#L2356'>phar</a>             2356 ext/phar/phar.c 		if (SUCCESS != phar_open_archive_fp(idata-&gt;phar)) {</span>
<span class='curline'><a href='../S/960.html#L2357'>phar</a>             2357 ext/phar/phar.c 			spprintf(error, 0, "phar error: unable to open zip-based phar archive \"%s\" to verify local file header for file \"%s\"", idata-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/960.html#L2364'>phar</a>             2364 ext/phar/phar.c 			spprintf(error, 0, "phar error: internal corruption of zip-based phar \"%s\" (cannot read local file header for file \"%s\")", idata-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/960.html#L2377'>phar</a>             2377 ext/phar/phar.c 				spprintf(error, 0, "phar error: internal corruption of zip-based phar \"%s\" (cannot read local data descriptor for file \"%s\")", idata-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/960.html#L2389'>phar</a>             2389 ext/phar/phar.c 			spprintf(error, 0, "phar error: internal corruption of zip-based phar \"%s\" (local header of file \"%s\" does not match central directory)", idata-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/960.html#L2418'>phar</a>             2418 ext/phar/phar.c 		spprintf(error, 0, "phar error: internal corruption of phar \"%s\" (crc32 mismatch on file \"%s\")", idata-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/960.html#L2495'>phar</a>             2495 ext/phar/phar.c int phar_flush(phar_archive_data *phar, char *user_stub, zend_long len, int convert, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L2516'>phar</a>             2516 ext/phar/phar.c 	if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/960.html#L2518'>phar</a>             2518 ext/phar/phar.c 			spprintf(error, 0, "internal error: attempt to flush cached zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2527'>phar</a>             2527 ext/phar/phar.c 	if (!zend_hash_num_elements(&amp;phar-&gt;manifest) &amp;&amp; !user_stub) {</span>
<span class='curline'><a href='../S/960.html#L2531'>phar</a>             2531 ext/phar/phar.c 	zend_hash_clean(&amp;phar-&gt;virtual_dirs);</span>
<span class='curline'><a href='../S/960.html#L2533'>phar</a>             2533 ext/phar/phar.c 	if (phar-&gt;is_zip) {</span>
<span class='curline'><a href='../S/960.html#L2534'>phar</a>             2534 ext/phar/phar.c 		return phar_zip_flush(phar, user_stub, len, convert, error);</span>
<span class='curline'><a href='../S/960.html#L2537'>phar</a>             2537 ext/phar/phar.c 	if (phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/960.html#L2538'>phar</a>             2538 ext/phar/phar.c 		return phar_tar_flush(phar, user_stub, len, convert, error);</span>
<span class='curline'><a href='../S/960.html#L2545'>phar</a>             2545 ext/phar/phar.c 	if (phar-&gt;fp &amp;&amp; !phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/960.html#L2546'>phar</a>             2546 ext/phar/phar.c 		oldfile = phar-&gt;fp;</span>
<span class='curline'><a href='../S/960.html#L2550'>phar</a>             2550 ext/phar/phar.c 		oldfile = php_stream_open_wrapper(phar-&gt;fname, "rb", 0, NULL);</span>
<span class='curline'><a href='../S/960.html#L2574'>phar</a>             2574 ext/phar/phar.c 					spprintf(error, 0, "unable to access resource to copy stub to new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2591'>phar</a>             2591 ext/phar/phar.c 					spprintf(error, 0, "unable to read resource to copy stub to new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2609'>phar</a>             2609 ext/phar/phar.c 				spprintf(error, 0, "illegal stub for phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2626'>phar</a>             2626 ext/phar/phar.c 				spprintf(error, 0, "unable to create stub from string in new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2633'>phar</a>             2633 ext/phar/phar.c 		phar-&gt;halt_offset = len + 5;</span>
<span class='curline'><a href='../S/960.html#L2640'>phar</a>             2640 ext/phar/phar.c 		if (!user_stub &amp;&amp; phar-&gt;halt_offset &amp;&amp; oldfile &amp;&amp; !phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/960.html#L2641'>phar</a>             2641 ext/phar/phar.c 			php_stream_copy_to_stream_ex(oldfile, newfile, phar-&gt;halt_offset, &amp;written);</span>
<span class='curline'><a href='../S/960.html#L2646'>phar</a>             2646 ext/phar/phar.c 			phar-&gt;halt_offset = ZSTR_LEN(newstub);</span>
<span class='curline'><a href='../S/960.html#L2647'>phar</a>             2647 ext/phar/phar.c 			written = php_stream_write(newfile, ZSTR_VAL(newstub), phar-&gt;halt_offset);</span>
<span class='curline'><a href='../S/960.html#L2649'>phar</a>             2649 ext/phar/phar.c 		if (phar-&gt;halt_offset != written) {</span>
<span class='curline'><a href='../S/960.html#L2656'>phar</a>             2656 ext/phar/phar.c 					spprintf(error, 0, "unable to create stub in new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2658'>phar</a>             2658 ext/phar/phar.c 					spprintf(error, 0, "unable to copy stub of old phar to new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2676'>phar</a>             2676 ext/phar/phar.c 	zend_hash_apply(&amp;phar-&gt;manifest, phar_flush_clean_deleted_apply);</span>
<span class='curline'><a href='../S/960.html#L2680'>phar</a>             2680 ext/phar/phar.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/960.html#L2682'>phar</a>             2682 ext/phar/phar.c 		php_var_serialize(&amp;main_metadata_str, &amp;phar-&gt;metadata, &amp;metadata_hash);</span>
<span class='curline'><a href='../S/960.html#L2687'>phar</a>             2687 ext/phar/phar.c 	for (zend_hash_internal_pointer_reset(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/960.html#L2688'>phar</a>             2688 ext/phar/phar.c 		zend_hash_has_more_elements(&amp;phar-&gt;manifest) == SUCCESS;</span>
<span class='curline'><a href='../S/960.html#L2689'>phar</a>             2689 ext/phar/phar.c 		zend_hash_move_forward(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/960.html#L2690'>phar</a>             2690 ext/phar/phar.c 		if ((entry = zend_hash_get_current_data_ptr(&amp;phar-&gt;manifest)) == NULL) {</span>
<span class='curline'><a href='../S/960.html#L2716'>phar</a>             2716 ext/phar/phar.c 		phar_add_virtual_dirs(phar, entry-&gt;filename, entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/960.html#L2750'>phar</a>             2750 ext/phar/phar.c 			newentry = phar_open_jit(phar, entry, error);</span>
<span class='curline'><a href='../S/960.html#L2766'>phar</a>             2766 ext/phar/phar.c 				spprintf(error, 0, "unable to seek to start of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2790'>phar</a>             2790 ext/phar/phar.c 					spprintf(error, 0, "unable to gzip compress file \"%s\" to new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2794'>phar</a>             2794 ext/phar/phar.c 					spprintf(error, 0, "unable to bzip2 compress file \"%s\" to new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2821'>phar</a>             2821 ext/phar/phar.c 				spprintf(error, 0, "unable to seek to start of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2832'>phar</a>             2832 ext/phar/phar.c 				spprintf(error, 0, "unable to copy compressed file contents of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2859'>phar</a>             2859 ext/phar/phar.c 	restore_alias_len = phar-&gt;alias_len;</span>
<span class='curline'><a href='../S/960.html#L2860'>phar</a>             2860 ext/phar/phar.c 	if (phar-&gt;is_temporary_alias) {</span>
<span class='curline'><a href='../S/960.html#L2861'>phar</a>             2861 ext/phar/phar.c 		phar-&gt;alias_len = 0;</span>
<span class='curline'><a href='../S/960.html#L2864'>phar</a>             2864 ext/phar/phar.c 	manifest_len = offset + phar-&gt;alias_len + sizeof(manifest) + (main_metadata_str.s ? ZSTR_LEN(main_metadata_str.s) : 0);</span>
<span class='curline'><a href='../S/960.html#L2881'>phar</a>             2881 ext/phar/phar.c 	phar_set_32(manifest+14, phar-&gt;alias_len);</span>
<span class='curline'><a href='../S/960.html#L2885'>phar</a>             2885 ext/phar/phar.c 	|| (size_t)phar-&gt;alias_len != php_stream_write(newfile, phar-&gt;alias, phar-&gt;alias_len)) {</span>
<span class='curline'><a href='../S/960.html#L2892'>phar</a>             2892 ext/phar/phar.c 		phar-&gt;alias_len = restore_alias_len;</span>
<span class='curline'><a href='../S/960.html#L2895'>phar</a>             2895 ext/phar/phar.c 			spprintf(error, 0, "unable to write manifest header of new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2901'>phar</a>             2901 ext/phar/phar.c 	phar-&gt;alias_len = restore_alias_len;</span>
<span class='curline'><a href='../S/960.html#L2913'>phar</a>             2913 ext/phar/phar.c 		phar-&gt;alias_len = restore_alias_len;</span>
<span class='curline'><a href='../S/960.html#L2916'>phar</a>             2916 ext/phar/phar.c 			spprintf(error, 0, "unable to write manifest meta-data of new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2927'>phar</a>             2927 ext/phar/phar.c 	for (zend_hash_internal_pointer_reset(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/960.html#L2928'>phar</a>             2928 ext/phar/phar.c 		zend_hash_has_more_elements(&amp;phar-&gt;manifest) == SUCCESS;</span>
<span class='curline'><a href='../S/960.html#L2929'>phar</a>             2929 ext/phar/phar.c 		zend_hash_move_forward(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/960.html#L2931'>phar</a>             2931 ext/phar/phar.c 		if ((entry = zend_hash_get_current_data_ptr(&amp;phar-&gt;manifest)) == NULL) {</span>
<span class='curline'><a href='../S/960.html#L2956'>phar</a>             2956 ext/phar/phar.c 					spprintf(error, 0, "unable to write filename of directory \"%s\" to manifest of new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2958'>phar</a>             2958 ext/phar/phar.c 					spprintf(error, 0, "unable to write filename of file \"%s\" to manifest of new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L2991'>phar</a>             2991 ext/phar/phar.c 				spprintf(error, 0, "unable to write temporary manifest of file \"%s\" to manifest of new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3016'>phar</a>             3016 ext/phar/phar.c 	for (zend_hash_internal_pointer_reset(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/960.html#L3017'>phar</a>             3017 ext/phar/phar.c 		zend_hash_has_more_elements(&amp;phar-&gt;manifest) == SUCCESS;</span>
<span class='curline'><a href='../S/960.html#L3018'>phar</a>             3018 ext/phar/phar.c 		zend_hash_move_forward(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/960.html#L3020'>phar</a>             3020 ext/phar/phar.c 		if ((entry = zend_hash_get_current_data_ptr(&amp;phar-&gt;manifest)) == NULL) {</span>
<span class='curline'><a href='../S/960.html#L3039'>phar</a>             3039 ext/phar/phar.c 					spprintf(error, 0, "unable to seek to start of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3051'>phar</a>             3051 ext/phar/phar.c 				spprintf(error, 0, "unable to seek to start of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3067'>phar</a>             3067 ext/phar/phar.c 				spprintf(error, 0, "unable to write contents of file \"%s\" to new phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3082'>phar</a>             3082 ext/phar/phar.c 			if (entry-&gt;fp_refcount == 0 &amp;&amp; entry-&gt;fp != phar-&gt;fp &amp;&amp; entry-&gt;fp != phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/960.html#L3099'>phar</a>             3099 ext/phar/phar.c 		if (phar-&gt;signature) {</span>
<span class='curline'><a href='../S/960.html#L3100'>phar</a>             3100 ext/phar/phar.c 			efree(phar-&gt;signature);</span>
<span class='curline'><a href='../S/960.html#L3101'>phar</a>             3101 ext/phar/phar.c 			phar-&gt;signature = NULL;</span>
<span class='curline'><a href='../S/960.html#L3104'>phar</a>             3104 ext/phar/phar.c 		switch(phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/960.html#L3113'>phar</a>             3113 ext/phar/phar.c 					spprintf(error, 0, "unable to write contents of file \"%s\" to new phar \"%s\" with requested hash type", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3121'>phar</a>             3121 ext/phar/phar.c 				if (FAILURE == phar_create_signature(phar, newfile, &amp;digest, &amp;digest_len, error)) {</span>
<span class='curline'><a href='../S/960.html#L3139'>phar</a>             3139 ext/phar/phar.c 				if (phar-&gt;sig_flags == PHAR_SIG_OPENSSL) {</span>
<span class='curline'><a href='../S/960.html#L3146'>phar</a>             3146 ext/phar/phar.c 		phar_set_32(sig_buf, phar-&gt;sig_flags);</span>
<span class='curline'><a href='../S/960.html#L3154'>phar</a>             3154 ext/phar/phar.c 	if (phar-&gt;fp &amp;&amp; free_fp) {</span>
<span class='curline'><a href='../S/960.html#L3155'>phar</a>             3155 ext/phar/phar.c 		php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L3158'>phar</a>             3158 ext/phar/phar.c 	if (phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/960.html#L3160'>phar</a>             3160 ext/phar/phar.c 			php_stream_close(phar-&gt;ufp);</span>
<span class='curline'><a href='../S/960.html#L3162'>phar</a>             3162 ext/phar/phar.c 		phar-&gt;ufp = NULL;</span>
<span class='curline'><a href='../S/960.html#L3169'>phar</a>             3169 ext/phar/phar.c 	phar-&gt;internal_file_start = halt_offset + manifest_len + 4;</span>
<span class='curline'><a href='../S/960.html#L3170'>phar</a>             3170 ext/phar/phar.c 	phar-&gt;halt_offset = halt_offset;</span>
<span class='curline'><a href='../S/960.html#L3171'>phar</a>             3171 ext/phar/phar.c 	phar-&gt;is_brandnew = 0;</span>
<span class='curline'><a href='../S/960.html#L3175'>phar</a>             3175 ext/phar/phar.c 	if (phar-&gt;donotflush) {</span>
<span class='curline'><a href='../S/960.html#L3177'>phar</a>             3177 ext/phar/phar.c 		phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/960.html#L3179'>phar</a>             3179 ext/phar/phar.c 		phar-&gt;fp = php_stream_open_wrapper(phar-&gt;fname, "w+b", IGNORE_URL|STREAM_MUST_SEEK|REPORT_ERRORS, NULL);</span>
<span class='curline'><a href='../S/960.html#L3180'>phar</a>             3180 ext/phar/phar.c 		if (!phar-&gt;fp) {</span>
<span class='curline'><a href='../S/960.html#L3181'>phar</a>             3181 ext/phar/phar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/960.html#L3183'>phar</a>             3183 ext/phar/phar.c 				spprintf(error, 4096, "unable to open new phar \"%s\" for writing", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3188'>phar</a>             3188 ext/phar/phar.c 		if (phar-&gt;flags &amp; PHAR_FILE_COMPRESSED_GZ) {</span>
<span class='curline'><a href='../S/960.html#L3194'>phar</a>             3194 ext/phar/phar.c 			filter = php_stream_filter_create("zlib.deflate", &amp;filterparams, php_stream_is_persistent(phar-&gt;fp));</span>
<span class='curline'><a href='../S/960.html#L3199'>phar</a>             3199 ext/phar/phar.c 					spprintf(error, 4096, "unable to compress all contents of phar \"%s\" using zlib, PHP versions older than 5.2.6 have a buggy zlib", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3204'>phar</a>             3204 ext/phar/phar.c 			php_stream_filter_append(&amp;phar-&gt;fp-&gt;writefilters, filter);</span>
<span class='curline'><a href='../S/960.html#L3205'>phar</a>             3205 ext/phar/phar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/960.html#L3208'>phar</a>             3208 ext/phar/phar.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L3210'>phar</a>             3210 ext/phar/phar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/960.html#L3211'>phar</a>             3211 ext/phar/phar.c 		} else if (phar-&gt;flags &amp; PHAR_FILE_COMPRESSED_BZ2) {</span>
<span class='curline'><a href='../S/960.html#L3212'>phar</a>             3212 ext/phar/phar.c 			filter = php_stream_filter_create("bzip2.compress", NULL, php_stream_is_persistent(phar-&gt;fp));</span>
<span class='curline'><a href='../S/960.html#L3213'>phar</a>             3213 ext/phar/phar.c 			php_stream_filter_append(&amp;phar-&gt;fp-&gt;writefilters, filter);</span>
<span class='curline'><a href='../S/960.html#L3214'>phar</a>             3214 ext/phar/phar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/960.html#L3217'>phar</a>             3217 ext/phar/phar.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L3219'>phar</a>             3219 ext/phar/phar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/960.html#L3221'>phar</a>             3221 ext/phar/phar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/960.html#L3227'>phar</a>             3227 ext/phar/phar.c 	if (-1 == php_stream_seek(phar-&gt;fp, phar-&gt;halt_offset, SEEK_SET)) {</span>
<span class='curline'><a href='../S/960.html#L3229'>phar</a>             3229 ext/phar/phar.c 			spprintf(error, 0, "unable to seek to __HALT_COMPILER(); in new phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/960.html#L3242'>phar</a>             3242 ext/phar/phar.c ZEND_GET_MODULE(phar)</span>
<span class='curline'><a href='../S/960.html#L3278'>phar</a>             3278 ext/phar/phar.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/960.html#L3284'>phar</a>             3284 ext/phar/phar.c 		if (SUCCESS == phar_open_from_filename((char*)file_handle-&gt;filename, strlen(file_handle-&gt;filename), NULL, 0, 0, &amp;phar, NULL)) {</span>
<span class='curline'><a href='../S/960.html#L3285'>phar</a>             3285 ext/phar/phar.c 			if (phar-&gt;is_zip || phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/960.html#L3302'>phar</a>             3302 ext/phar/phar.c 			} else if (phar-&gt;flags &amp; PHAR_FILE_COMPRESSION_MASK) {</span>
<span class='curline'><a href='../S/960.html#L3306'>phar</a>             3306 ext/phar/phar.c 				file_handle-&gt;handle.stream.handle  = phar;</span>
<span class='curline'><a href='../S/960.html#L3311'>phar</a>             3311 ext/phar/phar.c 				phar-&gt;is_persistent ?</span>
<span class='curline'><a href='../S/960.html#L3312'>phar</a>             3312 ext/phar/phar.c 					php_stream_rewind(PHAR_G(cached_fp)[phar-&gt;phar_pos].fp) :</span>
<span class='curline'><a href='../S/960.html#L3313'>phar</a>             3313 ext/phar/phar.c 					php_stream_rewind(phar-&gt;fp);</span>
<span class='curline'><a href='../S/960.html#L3348'>phar</a>             3348 ext/phar/phar.c PHP_GINIT_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3411'>phar</a>             3411 ext/phar/phar.c PHP_GSHUTDOWN_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3417'>phar</a>             3417 ext/phar/phar.c PHP_MINIT_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3436'>phar</a>             3436 ext/phar/phar.c PHP_MSHUTDOWN_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3491'>phar</a>             3491 ext/phar/phar.c PHP_RSHUTDOWN_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3538'>phar</a>             3538 ext/phar/phar.c PHP_MINFO_FUNCTION(phar) /* {{{ */</span>
<span class='curline'><a href='../S/960.html#L3606'>phar</a>             3606 ext/phar/phar.c 	PHP_MINIT(phar),</span>
<span class='curline'><a href='../S/960.html#L3607'>phar</a>             3607 ext/phar/phar.c 	PHP_MSHUTDOWN(phar),</span>
<span class='curline'><a href='../S/960.html#L3609'>phar</a>             3609 ext/phar/phar.c 	PHP_RSHUTDOWN(phar),</span>
<span class='curline'><a href='../S/960.html#L3610'>phar</a>             3610 ext/phar/phar.c 	PHP_MINFO(phar),</span>
<span class='curline'><a href='../S/960.html#L3612'>phar</a>             3612 ext/phar/phar.c 	PHP_MODULE_GLOBALS(phar),   /* globals descriptor */</span>
<span class='curline'><a href='../S/960.html#L3613'>phar</a>             3613 ext/phar/phar.c 	PHP_GINIT(phar),            /* globals ctor */</span>
<span class='curline'><a href='../S/960.html#L3614'>phar</a>             3614 ext/phar/phar.c 	PHP_GSHUTDOWN(phar),        /* globals dtor */</span>
<span class='curline'><a href='../S/961.html#L138'>phar</a>              138 ext/phar/phar_internal.h ZEND_BEGIN_MODULE_GLOBALS(phar)</span>
<span class='curline'><a href='../S/961.html#L195'>phar</a>              195 ext/phar/phar_internal.h ZEND_END_MODULE_GLOBALS(phar)</span>
<span class='curline'><a href='../S/961.html#L197'>phar</a>              197 ext/phar/phar_internal.h ZEND_EXTERN_MODULE_GLOBALS(phar)</span>
<span class='curline'><a href='../S/961.html#L198'>phar</a>              198 ext/phar/phar_internal.h #define PHAR_G(v) ZEND_MODULE_GLOBALS_ACCESSOR(phar, v)</span>
<span class='curline'><a href='../S/961.html#L259'>phar</a>              259 ext/phar/phar_internal.h 	phar_archive_data        *phar;</span>
<span class='curline'><a href='../S/961.html#L347'>phar</a>              347 ext/phar/phar_internal.h 		return entry-&gt;phar-&gt;fp;</span>
<span class='curline'><a href='../S/961.html#L349'>phar</a>              349 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].fp;</span>
<span class='curline'><a href='../S/961.html#L355'>phar</a>              355 ext/phar/phar_internal.h 		return entry-&gt;phar-&gt;ufp;</span>
<span class='curline'><a href='../S/961.html#L357'>phar</a>              357 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].ufp;</span>
<span class='curline'><a href='../S/961.html#L362'>phar</a>              362 ext/phar/phar_internal.h 	if (!entry-&gt;phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L363'>phar</a>              363 ext/phar/phar_internal.h 		entry-&gt;phar-&gt;fp =  fp;</span>
<span class='curline'><a href='../S/961.html#L367'>phar</a>              367 ext/phar/phar_internal.h 	PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].fp = fp;</span>
<span class='curline'><a href='../S/961.html#L372'>phar</a>              372 ext/phar/phar_internal.h 	if (!entry-&gt;phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L373'>phar</a>              373 ext/phar/phar_internal.h 		entry-&gt;phar-&gt;ufp =  fp;</span>
<span class='curline'><a href='../S/961.html#L377'>phar</a>              377 ext/phar/phar_internal.h 	PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].ufp = fp;</span>
<span class='curline'><a href='../S/961.html#L380'>phar</a>              380 ext/phar/phar_internal.h static inline php_stream *phar_get_pharfp(phar_archive_data *phar)</span>
<span class='curline'><a href='../S/961.html#L382'>phar</a>              382 ext/phar/phar_internal.h 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L383'>phar</a>              383 ext/phar/phar_internal.h 		return phar-&gt;fp;</span>
<span class='curline'><a href='../S/961.html#L385'>phar</a>              385 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[phar-&gt;phar_pos].fp;</span>
<span class='curline'><a href='../S/961.html#L388'>phar</a>              388 ext/phar/phar_internal.h static inline php_stream *phar_get_pharufp(phar_archive_data *phar)</span>
<span class='curline'><a href='../S/961.html#L390'>phar</a>              390 ext/phar/phar_internal.h 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L391'>phar</a>              391 ext/phar/phar_internal.h 		return phar-&gt;ufp;</span>
<span class='curline'><a href='../S/961.html#L393'>phar</a>              393 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[phar-&gt;phar_pos].ufp;</span>
<span class='curline'><a href='../S/961.html#L396'>phar</a>              396 ext/phar/phar_internal.h static inline void phar_set_pharfp(phar_archive_data *phar, php_stream *fp)</span>
<span class='curline'><a href='../S/961.html#L398'>phar</a>              398 ext/phar/phar_internal.h 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L399'>phar</a>              399 ext/phar/phar_internal.h 		phar-&gt;fp =  fp;</span>
<span class='curline'><a href='../S/961.html#L403'>phar</a>              403 ext/phar/phar_internal.h 	PHAR_G(cached_fp)[phar-&gt;phar_pos].fp = fp;</span>
<span class='curline'><a href='../S/961.html#L406'>phar</a>              406 ext/phar/phar_internal.h static inline void phar_set_pharufp(phar_archive_data *phar, php_stream *fp)</span>
<span class='curline'><a href='../S/961.html#L408'>phar</a>              408 ext/phar/phar_internal.h 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/961.html#L409'>phar</a>              409 ext/phar/phar_internal.h 		phar-&gt;ufp =  fp;</span>
<span class='curline'><a href='../S/961.html#L413'>phar</a>              413 ext/phar/phar_internal.h 	PHAR_G(cached_fp)[phar-&gt;phar_pos].ufp = fp;</span>
<span class='curline'><a href='../S/961.html#L425'>phar</a>              425 ext/phar/phar_internal.h 	data = &amp;(PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos]);</span>
<span class='curline'><a href='../S/961.html#L435'>phar</a>              435 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos].fp_type;</span>
<span class='curline'><a href='../S/961.html#L443'>phar</a>              443 ext/phar/phar_internal.h 	if (PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos].fp_type == PHAR_FP) {</span>
<span class='curline'><a href='../S/961.html#L444'>phar</a>              444 ext/phar/phar_internal.h 		if (!PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos].offset) {</span>
<span class='curline'><a href='../S/961.html#L445'>phar</a>              445 ext/phar/phar_internal.h 			PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos].offset = entry-&gt;offset;</span>
<span class='curline'><a href='../S/961.html#L448'>phar</a>              448 ext/phar/phar_internal.h 	return PHAR_G(cached_fp)[entry-&gt;phar-&gt;phar_pos].manifest[entry-&gt;manifest_pos].offset;</span>
<span class='curline'><a href='../S/961.html#L464'>phar</a>              464 ext/phar/phar_internal.h 	phar_archive_data        *phar;</span>
<span class='curline'><a href='../S/961.html#L529'>phar</a>              529 ext/phar/phar_internal.h 	tmp_len = MIN(MAXPATHLEN, entry-&gt;filename_len + entry-&gt;phar-&gt;fname_len);</span>
<span class='curline'><a href='../S/961.html#L531'>phar</a>              531 ext/phar/phar_internal.h 	len1 = MIN(entry-&gt;phar-&gt;fname_len, tmp_len);</span>
<span class='curline'><a href='../S/961.html#L532'>phar</a>              532 ext/phar/phar_internal.h 	memcpy(tmp, entry-&gt;phar-&gt;fname, len1);</span>
<span class='curline'><a href='../S/961.html#L544'>phar</a>              544 ext/phar/phar_internal.h void phar_destroy_phar_data(phar_archive_data *phar);</span>
<span class='curline'><a href='../S/961.html#L546'>phar</a>              546 ext/phar/phar_internal.h int phar_open_entry_file(phar_archive_data *phar, phar_entry_info *entry, char **error);</span>
<span class='curline'><a href='../S/961.html#L552'>phar</a>              552 ext/phar/phar_internal.h int phar_free_alias(phar_archive_data *phar, char *alias, int alias_len);</span>
<span class='curline'><a href='../S/961.html#L556'>phar</a>              556 ext/phar/phar_internal.h int phar_create_signature(phar_archive_data *phar, php_stream *fp, char **signature, int *signature_length, char **error);</span>
<span class='curline'><a href='../S/961.html#L563'>phar</a>              563 ext/phar/phar_internal.h void phar_remove_virtual_dirs(phar_archive_data *phar, char *filename, int filename_len);</span>
<span class='curline'><a href='../S/961.html#L564'>phar</a>              564 ext/phar/phar_internal.h void phar_add_virtual_dirs(phar_archive_data *phar, char *filename, int filename_len);</span>
<span class='curline'><a href='../S/961.html#L565'>phar</a>              565 ext/phar/phar_internal.h int phar_mount_entry(phar_archive_data *phar, char *filename, int filename_len, char *path, int path_len);</span>
<span class='curline'><a href='../S/961.html#L568'>phar</a>              568 ext/phar/phar_internal.h phar_entry_info * phar_open_jit(phar_archive_data *phar, phar_entry_info *entry, char **error);</span>
<span class='curline'><a href='../S/961.html#L576'>phar</a>              576 ext/phar/phar_internal.h int phar_create_writeable_entry(phar_archive_data *phar, phar_entry_info *entry, char **error);</span>
<span class='curline'><a href='../S/961.html#L578'>phar</a>              578 ext/phar/phar_internal.h int phar_open_archive_fp(phar_archive_data *phar);</span>
<span class='curline'><a href='../S/961.html#L585'>phar</a>              585 ext/phar/phar_internal.h int phar_tar_flush(phar_archive_data *phar, char *user_stub, zend_long len, int defaultstub, char **error);</span>
<span class='curline'><a href='../S/961.html#L600'>phar</a>              600 ext/phar/phar_internal.h int phar_archive_delref(phar_archive_data *phar);</span>
<span class='curline'><a href='../S/961.html#L603'>phar</a>              603 ext/phar/phar_internal.h phar_entry_info *phar_get_entry_info(phar_archive_data *phar, char *path, int path_len, char **error, int security);</span>
<span class='curline'><a href='../S/961.html#L604'>phar</a>              604 ext/phar/phar_internal.h phar_entry_info *phar_get_entry_info_dir(phar_archive_data *phar, char *path, int path_len, char dir, char **error, int security);</span>
<span class='curline'><a href='../S/962.html#L145'>phar</a>              145 ext/phar/phar_object.c static int phar_file_action(phar_archive_data *phar, phar_entry_info *info, char *mime_type, int code, char *entry, int entry_len, char *arch, char *basename, char *ru, int ru_len) /* {{{ */</span>
<span class='curline'><a href='../S/962.html#L197'>phar</a>              197 ext/phar/phar_object.c 				if (!phar_open_jit(phar, info, &amp;error)) {</span>
<span class='curline'><a href='../S/962.html#L325'>phar</a>              325 ext/phar/phar_object.c static void phar_do_404(phar_archive_data *phar, char *fname, int fname_len, char *f404, size_t f404_len, char *entry, size_t entry_len) /* {{{ */</span>
<span class='curline'><a href='../S/962.html#L330'>phar</a>              330 ext/phar/phar_object.c 	if (phar &amp;&amp; f404_len) {</span>
<span class='curline'><a href='../S/962.html#L331'>phar</a>              331 ext/phar/phar_object.c 		info = phar_get_entry_info(phar, f404, f404_len, NULL, 1);</span>
<span class='curline'><a href='../S/962.html#L334'>phar</a>              334 ext/phar/phar_object.c 			phar_file_action(phar, info, "text/html", PHAR_MIME_PHP, f404, f404_len, fname, NULL, NULL, 0);</span>
<span class='curline'><a href='../S/962.html#L555'>phar</a>              555 ext/phar/phar_object.c 	phar_archive_data *phar = NULL;</span>
<span class='curline'><a href='../S/962.html#L752'>phar</a>              752 ext/phar/phar_object.c 		if (FAILURE == phar_get_archive(&amp;phar, fname, fname_len, NULL, 0, NULL) ||</span>
<span class='curline'><a href='../S/962.html#L753'>phar</a>              753 ext/phar/phar_object.c 			(info = phar_get_entry_info(phar, entry, entry_len, NULL, 0)) == NULL) {</span>
<span class='curline'><a href='../S/962.html#L754'>phar</a>              754 ext/phar/phar_object.c 			phar_do_404(phar, fname, fname_len, f404, f404_len, entry, entry_len);</span>
<span class='curline'><a href='../S/962.html#L798'>phar</a>              798 ext/phar/phar_object.c 	if (FAILURE == phar_get_archive(&amp;phar, fname, fname_len, NULL, 0, NULL) ||</span>
<span class='curline'><a href='../S/962.html#L799'>phar</a>              799 ext/phar/phar_object.c 		(info = phar_get_entry_info(phar, entry, entry_len, NULL, 0)) == NULL) {</span>
<span class='curline'><a href='../S/962.html#L800'>phar</a>              800 ext/phar/phar_object.c 		phar_do_404(phar, fname, fname_len, f404, f404_len, entry, entry_len);</span>
<span class='curline'><a href='../S/962.html#L856'>phar</a>              856 ext/phar/phar_object.c 	phar_file_action(phar, info, mime_type, code, entry, entry_len, fname, pt, ru, ru_len);</span>
<span class='curline'><a href='../S/962.html#L1080'>phar</a>             1080 ext/phar/phar_object.c 	phar_archive_data *phar = (phar_archive_data *) object-&gt;oth;</span>
<span class='curline'><a href='../S/962.html#L1082'>phar</a>             1082 ext/phar/phar_object.c 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/962.html#L1083'>phar</a>             1083 ext/phar/phar_object.c 		phar_archive_delref(phar);</span>
<span class='curline'><a href='../S/962.html#L1308'>phar</a>             1308 ext/phar/phar_object.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/962.html#L1319'>phar</a>             1319 ext/phar/phar_object.c 	if (FAILURE == phar_open_from_filename(fname, fname_len, NULL, 0, REPORT_ERRORS, &amp;phar, &amp;error)) {</span>
<span class='curline'><a href='../S/962.html#L1343'>phar</a>             1343 ext/phar/phar_object.c 	if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/962.html#L1348'>phar</a>             1348 ext/phar/phar_object.c 	if (phar-&gt;refcount) {</span>
<span class='curline'><a href='../S/962.html#L1353'>phar</a>             1353 ext/phar/phar_object.c 	fname = estrndup(phar-&gt;fname, phar-&gt;fname_len);</span>
<span class='curline'><a href='../S/962.html#L1359'>phar</a>             1359 ext/phar/phar_object.c 	phar_archive_delref(phar);</span>
<span class='curline'><a href='../S/962.html#L1962'>phar</a>             1962 ext/phar/phar_object.c 				"Cannot convert phar archive \"%s\", unable to open entry \"%s\" contents: %s", entry-&gt;phar-&gt;fname, entry-&gt;filename, error);</span>
<span class='curline'><a href='../S/962.html#L1966'>phar</a>             1966 ext/phar/phar_object.c 				"Cannot convert phar archive \"%s\", unable to open entry \"%s\" contents", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/962.html#L1982'>phar</a>             1982 ext/phar/phar_object.c 			"Cannot convert phar archive \"%s\", unable to copy entry \"%s\" contents", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/962.html#L2002'>phar</a>             2002 ext/phar/phar_object.c 	phar_archive_data *phar = *sphar;</span>
<span class='curline'><a href='../S/962.html#L2016'>phar</a>             2016 ext/phar/phar_object.c 		if (phar-&gt;is_zip) {</span>
<span class='curline'><a href='../S/962.html#L2018'>phar</a>             2018 ext/phar/phar_object.c 			if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2024'>phar</a>             2024 ext/phar/phar_object.c 		} else if (phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/962.html#L2026'>phar</a>             2026 ext/phar/phar_object.c 			switch (phar-&gt;flags) {</span>
<span class='curline'><a href='../S/962.html#L2028'>phar</a>             2028 ext/phar/phar_object.c 					if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2035'>phar</a>             2035 ext/phar/phar_object.c 					if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2042'>phar</a>             2042 ext/phar/phar_object.c 					if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2050'>phar</a>             2050 ext/phar/phar_object.c 			switch (phar-&gt;flags) {</span>
<span class='curline'><a href='../S/962.html#L2063'>phar</a>             2063 ext/phar/phar_object.c 		if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2064'>phar</a>             2064 ext/phar/phar_object.c 			zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "data phar converted from \"%s\" has invalid extension %s", phar-&gt;fname, ext);</span>
<span class='curline'><a href='../S/962.html#L2066'>phar</a>             2066 ext/phar/phar_object.c 			zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "phar converted from \"%s\" has invalid extension %s", phar-&gt;fname, ext);</span>
<span class='curline'><a href='../S/962.html#L2075'>phar</a>             2075 ext/phar/phar_object.c 	oldpath = estrndup(phar-&gt;fname, phar-&gt;fname_len);</span>
<span class='curline'><a href='../S/962.html#L2076'>phar</a>             2076 ext/phar/phar_object.c 	if ((oldname = zend_memrchr(phar-&gt;fname, '/', phar-&gt;fname_len))) {</span>
<span class='curline'><a href='../S/962.html#L2079'>phar</a>             2079 ext/phar/phar_object.c 		oldname = phar-&gt;fname;</span>
<span class='curline'><a href='../S/962.html#L2090'>phar</a>             2090 ext/phar/phar_object.c 	phar-&gt;fname_len = spprintf(&amp;newpath, 0, "%s%s", basepath, newname);</span>
<span class='curline'><a href='../S/962.html#L2091'>phar</a>             2091 ext/phar/phar_object.c 	phar-&gt;fname = newpath;</span>
<span class='curline'><a href='../S/962.html#L2092'>phar</a>             2092 ext/phar/phar_object.c 	phar-&gt;ext = newpath + phar-&gt;fname_len - strlen(ext) - 1;</span>
<span class='curline'><a href='../S/962.html#L2096'>phar</a>             2096 ext/phar/phar_object.c 	if (PHAR_G(manifest_cached) &amp;&amp; NULL != (pphar = zend_hash_str_find_ptr(&amp;cached_phars, newpath, phar-&gt;fname_len))) {</span>
<span class='curline'><a href='../S/962.html#L2098'>phar</a>             2098 ext/phar/phar_object.c 		zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "Unable to add newly converted phar \"%s\" to the list of phars, new phar name is in phar.cache_list", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L2102'>phar</a>             2102 ext/phar/phar_object.c 	if (NULL != (pphar = zend_hash_str_find_ptr(&amp;(PHAR_G(phar_fname_map)), newpath, phar-&gt;fname_len))) {</span>
<span class='curline'><a href='../S/962.html#L2103'>phar</a>             2103 ext/phar/phar_object.c 		if (pphar-&gt;fname_len == phar-&gt;fname_len &amp;&amp; !memcmp(pphar-&gt;fname, phar-&gt;fname, phar-&gt;fname_len)) {</span>
<span class='curline'><a href='../S/962.html#L2104'>phar</a>             2104 ext/phar/phar_object.c 			if (!zend_hash_num_elements(&amp;phar-&gt;manifest)) {</span>
<span class='curline'><a href='../S/962.html#L2105'>phar</a>             2105 ext/phar/phar_object.c 				pphar-&gt;is_tar = phar-&gt;is_tar;</span>
<span class='curline'><a href='../S/962.html#L2106'>phar</a>             2106 ext/phar/phar_object.c 				pphar-&gt;is_zip = phar-&gt;is_zip;</span>
<span class='curline'><a href='../S/962.html#L2107'>phar</a>             2107 ext/phar/phar_object.c 				pphar-&gt;is_data = phar-&gt;is_data;</span>
<span class='curline'><a href='../S/962.html#L2108'>phar</a>             2108 ext/phar/phar_object.c 				pphar-&gt;flags = phar-&gt;flags;</span>
<span class='curline'><a href='../S/962.html#L2109'>phar</a>             2109 ext/phar/phar_object.c 				pphar-&gt;fp = phar-&gt;fp;</span>
<span class='curline'><a href='../S/962.html#L2110'>phar</a>             2110 ext/phar/phar_object.c 				phar-&gt;fp = NULL;</span>
<span class='curline'><a href='../S/962.html#L2111'>phar</a>             2111 ext/phar/phar_object.c 				phar_destroy_phar_data(phar);</span>
<span class='curline'><a href='../S/962.html#L2113'>phar</a>             2113 ext/phar/phar_object.c 				phar = pphar;</span>
<span class='curline'><a href='../S/962.html#L2114'>phar</a>             2114 ext/phar/phar_object.c 				phar-&gt;refcount++;</span>
<span class='curline'><a href='../S/962.html#L2121'>phar</a>             2121 ext/phar/phar_object.c 		zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "Unable to add newly converted phar \"%s\" to the list of phars, a phar with that name already exists", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L2130'>phar</a>             2130 ext/phar/phar_object.c 	if (!phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2131'>phar</a>             2131 ext/phar/phar_object.c 		if (SUCCESS != phar_detect_phar_fname_ext(newpath, phar-&gt;fname_len, (const char **) &amp;(phar-&gt;ext), &amp;(phar-&gt;ext_len), 1, 1, 1)) {</span>
<span class='curline'><a href='../S/962.html#L2133'>phar</a>             2133 ext/phar/phar_object.c 			zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "phar \"%s\" has invalid extension %s", phar-&gt;fname, ext);</span>
<span class='curline'><a href='../S/962.html#L2137'>phar</a>             2137 ext/phar/phar_object.c 		if (phar-&gt;alias) {</span>
<span class='curline'><a href='../S/962.html#L2138'>phar</a>             2138 ext/phar/phar_object.c 			if (phar-&gt;is_temporary_alias) {</span>
<span class='curline'><a href='../S/962.html#L2139'>phar</a>             2139 ext/phar/phar_object.c 				phar-&gt;alias = NULL;</span>
<span class='curline'><a href='../S/962.html#L2140'>phar</a>             2140 ext/phar/phar_object.c 				phar-&gt;alias_len = 0;</span>
<span class='curline'><a href='../S/962.html#L2142'>phar</a>             2142 ext/phar/phar_object.c 				phar-&gt;alias = estrndup(newpath, strlen(newpath));</span>
<span class='curline'><a href='../S/962.html#L2143'>phar</a>             2143 ext/phar/phar_object.c 				phar-&gt;alias_len = strlen(newpath);</span>
<span class='curline'><a href='../S/962.html#L2144'>phar</a>             2144 ext/phar/phar_object.c 				phar-&gt;is_temporary_alias = 1;</span>
<span class='curline'><a href='../S/962.html#L2145'>phar</a>             2145 ext/phar/phar_object.c 				zend_hash_str_update_ptr(&amp;(PHAR_G(phar_alias_map)), newpath, phar-&gt;fname_len, phar);</span>
<span class='curline'><a href='../S/962.html#L2151'>phar</a>             2151 ext/phar/phar_object.c 		if (SUCCESS != phar_detect_phar_fname_ext(newpath, phar-&gt;fname_len, (const char **) &amp;(phar-&gt;ext), &amp;(phar-&gt;ext_len), 0, 1, 1)) {</span>
<span class='curline'><a href='../S/962.html#L2153'>phar</a>             2153 ext/phar/phar_object.c 			zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "data phar \"%s\" has invalid extension %s", phar-&gt;fname, ext);</span>
<span class='curline'><a href='../S/962.html#L2157'>phar</a>             2157 ext/phar/phar_object.c 		phar-&gt;alias = NULL;</span>
<span class='curline'><a href='../S/962.html#L2158'>phar</a>             2158 ext/phar/phar_object.c 		phar-&gt;alias_len = 0;</span>
<span class='curline'><a href='../S/962.html#L2161'>phar</a>             2161 ext/phar/phar_object.c 	if ((!pphar || phar == pphar) &amp;&amp; NULL == zend_hash_str_update_ptr(&amp;(PHAR_G(phar_fname_map)), newpath, phar-&gt;fname_len, phar)) {</span>
<span class='curline'><a href='../S/962.html#L2163'>phar</a>             2163 ext/phar/phar_object.c 		zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "Unable to add newly converted phar \"%s\" to the list of phars", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L2167'>phar</a>             2167 ext/phar/phar_object.c 	phar_flush(phar, 0, 0, 1, &amp;error);</span>
<span class='curline'><a href='../S/962.html#L2178'>phar</a>             2178 ext/phar/phar_object.c 	if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L2187'>phar</a>             2187 ext/phar/phar_object.c 		zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "Unable to instantiate phar object when converting archive \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L2191'>phar</a>             2191 ext/phar/phar_object.c 	ZVAL_STRINGL(&amp;arg1, phar-&gt;fname, phar-&gt;fname_len);</span>
<span class='curline'><a href='../S/962.html#L2201'>phar</a>             2201 ext/phar/phar_object.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/962.html#L2209'>phar</a>             2209 ext/phar/phar_object.c 	phar = (phar_archive_data *) ecalloc(1, sizeof(phar_archive_data));</span>
<span class='curline'><a href='../S/962.html#L2211'>phar</a>             2211 ext/phar/phar_object.c 	phar-&gt;flags = flags;</span>
<span class='curline'><a href='../S/962.html#L2212'>phar</a>             2212 ext/phar/phar_object.c 	phar-&gt;is_data = source-&gt;is_data;</span>
<span class='curline'><a href='../S/962.html#L2216'>phar</a>             2216 ext/phar/phar_object.c 			phar-&gt;is_tar = 1;</span>
<span class='curline'><a href='../S/962.html#L2219'>phar</a>             2219 ext/phar/phar_object.c 			phar-&gt;is_zip = 1;</span>
<span class='curline'><a href='../S/962.html#L2222'>phar</a>             2222 ext/phar/phar_object.c 			phar-&gt;is_data = 0;</span>
<span class='curline'><a href='../S/962.html#L2226'>phar</a>             2226 ext/phar/phar_object.c 	zend_hash_init(&amp;(phar-&gt;manifest), sizeof(phar_entry_info),</span>
<span class='curline'><a href='../S/962.html#L2228'>phar</a>             2228 ext/phar/phar_object.c 	zend_hash_init(&amp;phar-&gt;mounted_dirs, sizeof(char *),</span>
<span class='curline'><a href='../S/962.html#L2230'>phar</a>             2230 ext/phar/phar_object.c 	zend_hash_init(&amp;phar-&gt;virtual_dirs, sizeof(char *),</span>
<span class='curline'><a href='../S/962.html#L2233'>phar</a>             2233 ext/phar/phar_object.c 	phar-&gt;fp = php_stream_fopen_tmpfile();</span>
<span class='curline'><a href='../S/962.html#L2234'>phar</a>             2234 ext/phar/phar_object.c 	if (phar-&gt;fp == NULL) {</span>
<span class='curline'><a href='../S/962.html#L2238'>phar</a>             2238 ext/phar/phar_object.c 	phar-&gt;fname = source-&gt;fname;</span>
<span class='curline'><a href='../S/962.html#L2239'>phar</a>             2239 ext/phar/phar_object.c 	phar-&gt;fname_len = source-&gt;fname_len;</span>
<span class='curline'><a href='../S/962.html#L2240'>phar</a>             2240 ext/phar/phar_object.c 	phar-&gt;is_temporary_alias = source-&gt;is_temporary_alias;</span>
<span class='curline'><a href='../S/962.html#L2241'>phar</a>             2241 ext/phar/phar_object.c 	phar-&gt;alias = source-&gt;alias;</span>
<span class='curline'><a href='../S/962.html#L2244'>phar</a>             2244 ext/phar/phar_object.c 		ZVAL_DUP(&amp;phar-&gt;metadata, &amp;source-&gt;metadata);</span>
<span class='curline'><a href='../S/962.html#L2245'>phar</a>             2245 ext/phar/phar_object.c 		phar-&gt;metadata_len = 0;</span>
<span class='curline'><a href='../S/962.html#L2265'>phar</a>             2265 ext/phar/phar_object.c 		if (FAILURE == phar_copy_file_contents(&amp;newentry, phar-&gt;fp)) {</span>
<span class='curline'><a href='../S/962.html#L2266'>phar</a>             2266 ext/phar/phar_object.c 			zend_hash_destroy(&amp;(phar-&gt;manifest));</span>
<span class='curline'><a href='../S/962.html#L2267'>phar</a>             2267 ext/phar/phar_object.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/962.html#L2268'>phar</a>             2268 ext/phar/phar_object.c 			efree(phar);</span>
<span class='curline'><a href='../S/962.html#L2280'>phar</a>             2280 ext/phar/phar_object.c 		newentry.is_zip = phar-&gt;is_zip;</span>
<span class='curline'><a href='../S/962.html#L2281'>phar</a>             2281 ext/phar/phar_object.c 		newentry.is_tar = phar-&gt;is_tar;</span>
<span class='curline'><a href='../S/962.html#L2288'>phar</a>             2288 ext/phar/phar_object.c 		newentry.phar = phar;</span>
<span class='curline'><a href='../S/962.html#L2291'>phar</a>             2291 ext/phar/phar_object.c 		zend_hash_str_add_mem(&amp;(phar-&gt;manifest), newentry.filename, newentry.filename_len, (void*)&amp;newentry, sizeof(phar_entry_info));</span>
<span class='curline'><a href='../S/962.html#L2292'>phar</a>             2292 ext/phar/phar_object.c 		phar_add_virtual_dirs(phar, newentry.filename, newentry.filename_len);</span>
<span class='curline'><a href='../S/962.html#L2295'>phar</a>             2295 ext/phar/phar_object.c 	if ((ret = phar_rename_archive(&amp;phar, ext, 0))) {</span>
<span class='curline'><a href='../S/962.html#L2298'>phar</a>             2298 ext/phar/phar_object.c 		if(phar != NULL) {</span>
<span class='curline'><a href='../S/962.html#L2299'>phar</a>             2299 ext/phar/phar_object.c 			zend_hash_destroy(&amp;(phar-&gt;manifest));</span>
<span class='curline'><a href='../S/962.html#L2300'>phar</a>             2300 ext/phar/phar_object.c 			zend_hash_destroy(&amp;(phar-&gt;mounted_dirs));</span>
<span class='curline'><a href='../S/962.html#L2301'>phar</a>             2301 ext/phar/phar_object.c 			zend_hash_destroy(&amp;(phar-&gt;virtual_dirs));</span>
<span class='curline'><a href='../S/962.html#L2302'>phar</a>             2302 ext/phar/phar_object.c 			if (phar-&gt;fp) {</span>
<span class='curline'><a href='../S/962.html#L2303'>phar</a>             2303 ext/phar/phar_object.c 				php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/962.html#L2305'>phar</a>             2305 ext/phar/phar_object.c 			efree(phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L2306'>phar</a>             2306 ext/phar/phar_object.c 			efree(phar);</span>
<span class='curline'><a href='../S/962.html#L3479'>phar</a>             3479 ext/phar/phar_object.c 	zend_hash_str_add_mem(&amp;oldentry-&gt;phar-&gt;manifest, newfile, newfile_len, &amp;newentry, sizeof(phar_entry_info));</span>
<span class='curline'><a href='../S/962.html#L3623'>phar</a>             3623 ext/phar/phar_object.c 		if (pphar[0] != data-&gt;phar) {</span>
<span class='curline'><a href='../S/962.html#L3624'>phar</a>             3624 ext/phar/phar_object.c 			*pphar = data-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L3659'>phar</a>             3659 ext/phar/phar_object.c 		if (data-&gt;phar != *pphar) {</span>
<span class='curline'><a href='../S/962.html#L3660'>phar</a>             3660 ext/phar/phar_object.c 			*pphar = data-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L4364'>phar</a>             4364 ext/phar/phar_object.c 		phar_archive_data *phar;</span>
<span class='curline'><a href='../S/962.html#L4366'>phar</a>             4366 ext/phar/phar_object.c 		phar = phar_obj-&gt;archive;</span>
<span class='curline'><a href='../S/962.html#L4368'>phar</a>             4368 ext/phar/phar_object.c 		if (!zend_hash_num_elements(&amp;(phar-&gt;manifest))) {</span>
<span class='curline'><a href='../S/962.html#L4372'>phar</a>             4372 ext/phar/phar_object.c 		ZEND_HASH_FOREACH_PTR(&amp;phar-&gt;manifest, entry) {</span>
<span class='curline'><a href='../S/962.html#L4375'>phar</a>             4375 ext/phar/phar_object.c 					"Extraction from phar \"%s\" failed: %s", phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/962.html#L4594'>phar</a>             4594 ext/phar/phar_object.c 	if (PHAR_G(readonly) &amp;&amp; !entry_obj-&gt;entry-&gt;phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L4595'>phar</a>             4595 ext/phar/phar_object.c 		zend_throw_exception_ex(phar_ce_PharException, 0, "Cannot modify permissions for file \"%s\" in phar \"%s\", write operations are prohibited", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4604'>phar</a>             4604 ext/phar/phar_object.c 		phar_archive_data *phar = entry_obj-&gt;entry-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L4606'>phar</a>             4606 ext/phar/phar_object.c 		if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/962.html#L4607'>phar</a>             4607 ext/phar/phar_object.c 			zend_throw_exception_ex(phar_ce_PharException, 0, "phar \"%s\" is persistent, unable to copy on write", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4611'>phar</a>             4611 ext/phar/phar_object.c 		entry_obj-&gt;entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/962.html#L4618'>phar</a>             4618 ext/phar/phar_object.c 	entry_obj-&gt;entry-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/962.html#L4633'>phar</a>             4633 ext/phar/phar_object.c 	phar_flush(entry_obj-&gt;entry-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/962.html#L4691'>phar</a>             4691 ext/phar/phar_object.c 	if (PHAR_G(readonly) &amp;&amp; !entry_obj-&gt;entry-&gt;phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L4707'>phar</a>             4707 ext/phar/phar_object.c 		phar_archive_data *phar = entry_obj-&gt;entry-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L4709'>phar</a>             4709 ext/phar/phar_object.c 		if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/962.html#L4710'>phar</a>             4710 ext/phar/phar_object.c 			zend_throw_exception_ex(phar_ce_PharException, 0, "phar \"%s\" is persistent, unable to copy on write", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4714'>phar</a>             4714 ext/phar/phar_object.c 		entry_obj-&gt;entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/962.html#L4724'>phar</a>             4724 ext/phar/phar_object.c 	entry_obj-&gt;entry-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/962.html#L4725'>phar</a>             4725 ext/phar/phar_object.c 	phar_flush(entry_obj-&gt;entry-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/962.html#L4747'>phar</a>             4747 ext/phar/phar_object.c 	if (PHAR_G(readonly) &amp;&amp; !entry_obj-&gt;entry-&gt;phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L4760'>phar</a>             4760 ext/phar/phar_object.c 			phar_archive_data *phar = entry_obj-&gt;entry-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L4762'>phar</a>             4762 ext/phar/phar_object.c 			if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/962.html#L4763'>phar</a>             4763 ext/phar/phar_object.c 				zend_throw_exception_ex(phar_ce_PharException, 0, "phar \"%s\" is persistent, unable to copy on write", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4767'>phar</a>             4767 ext/phar/phar_object.c 			entry_obj-&gt;entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/962.html#L4772'>phar</a>             4772 ext/phar/phar_object.c 		entry_obj-&gt;entry-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/962.html#L4774'>phar</a>             4774 ext/phar/phar_object.c 		phar_flush(entry_obj-&gt;entry-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/962.html#L4808'>phar</a>             4808 ext/phar/phar_object.c 			"Phar error: Cannot retrieve contents, \"%s\" in phar \"%s\" is a directory", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4820'>phar</a>             4820 ext/phar/phar_object.c 			"Phar error: Cannot retrieve contents, \"%s\" in phar \"%s\": %s", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/962.html#L4827'>phar</a>             4827 ext/phar/phar_object.c 			"Phar error: Cannot retrieve contents of \"%s\" in phar \"%s\"", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4866'>phar</a>             4866 ext/phar/phar_object.c 	if (PHAR_G(readonly) &amp;&amp; !entry_obj-&gt;entry-&gt;phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L4879'>phar</a>             4879 ext/phar/phar_object.c 		phar_archive_data *phar = entry_obj-&gt;entry-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L4881'>phar</a>             4881 ext/phar/phar_object.c 		if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/962.html#L4882'>phar</a>             4882 ext/phar/phar_object.c 			zend_throw_exception_ex(phar_ce_PharException, 0, "phar \"%s\" is persistent, unable to copy on write", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L4886'>phar</a>             4886 ext/phar/phar_object.c 		entry_obj-&gt;entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/962.html#L4904'>phar</a>             4904 ext/phar/phar_object.c 						"Phar error: Cannot decompress bzip2-compressed file \"%s\" in phar \"%s\" in order to compress with gzip: %s", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/962.html#L4935'>phar</a>             4935 ext/phar/phar_object.c 						"Phar error: Cannot decompress gzip-compressed file \"%s\" in phar \"%s\" in order to compress with bzip2: %s", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname, error);</span>
<span class='curline'><a href='../S/962.html#L4955'>phar</a>             4955 ext/phar/phar_object.c 	entry_obj-&gt;entry-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/962.html#L4957'>phar</a>             4957 ext/phar/phar_object.c 	phar_flush(entry_obj-&gt;entry-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/962.html#L4990'>phar</a>             4990 ext/phar/phar_object.c 	if (PHAR_G(readonly) &amp;&amp; !entry_obj-&gt;entry-&gt;phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/962.html#L5015'>phar</a>             5015 ext/phar/phar_object.c 		phar_archive_data *phar = entry_obj-&gt;entry-&gt;phar;</span>
<span class='curline'><a href='../S/962.html#L5017'>phar</a>             5017 ext/phar/phar_object.c 		if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/962.html#L5018'>phar</a>             5018 ext/phar/phar_object.c 			zend_throw_exception_ex(phar_ce_PharException, 0, "phar \"%s\" is persistent, unable to copy on write", phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L5022'>phar</a>             5022 ext/phar/phar_object.c 		entry_obj-&gt;entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/962.html#L5025'>phar</a>             5025 ext/phar/phar_object.c 		if (FAILURE == phar_open_archive_fp(entry_obj-&gt;entry-&gt;phar)) {</span>
<span class='curline'><a href='../S/962.html#L5026'>phar</a>             5026 ext/phar/phar_object.c 			zend_throw_exception_ex(spl_ce_BadMethodCallException, 0, "Cannot decompress entry \"%s\", phar error: Cannot open phar archive \"%s\" for reading", entry_obj-&gt;entry-&gt;filename, entry_obj-&gt;entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/962.html#L5034'>phar</a>             5034 ext/phar/phar_object.c 	entry_obj-&gt;entry-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/962.html#L5036'>phar</a>             5036 ext/phar/phar_object.c 	phar_flush(entry_obj-&gt;entry-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/966.html#L104'>phar</a>              104 ext/phar/stream.c 		phar_archive_data *pphar = NULL, *phar;</span>
<span class='curline'><a href='../S/966.html#L116'>phar</a>              116 ext/phar/stream.c 		if (phar_open_or_create_filename(resource-&gt;host, arch_len, NULL, 0, 0, options, &amp;phar, &amp;error) == FAILURE)</span>
<span class='curline'><a href='../S/966.html#L127'>phar</a>              127 ext/phar/stream.c 		if (phar-&gt;is_persistent &amp;&amp; FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/966.html#L160'>phar</a>              160 ext/phar/stream.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/966.html#L231'>phar</a>              231 ext/phar/stream.c 				idata-&gt;phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/966.html#L235'>phar</a>              235 ext/phar/stream.c 			*opened_path = strpprintf(MAXPATHLEN, "phar://%s/%s", idata-&gt;phar-&gt;fname, idata-&gt;internal_file-&gt;filename);</span>
<span class='curline'><a href='../S/966.html#L241'>phar</a>              241 ext/phar/stream.c 			if (FAILURE == phar_get_archive(&amp;phar, resource-&gt;host, host_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/966.html#L247'>phar</a>              247 ext/phar/stream.c 			if (phar-&gt;is_tar || phar-&gt;is_zip) {</span>
<span class='curline'><a href='../S/966.html#L253'>phar</a>              253 ext/phar/stream.c 					*opened_path = strpprintf(MAXPATHLEN, "%s", phar-&gt;fname);</span>
<span class='curline'><a href='../S/966.html#L264'>phar</a>              264 ext/phar/stream.c 				entry-&gt;phar = phar;</span>
<span class='curline'><a href='../S/966.html#L266'>phar</a>              266 ext/phar/stream.c 				entry-&gt;compressed_filesize = entry-&gt;uncompressed_filesize = phar-&gt;halt_offset;</span>
<span class='curline'><a href='../S/966.html#L270'>phar</a>              270 ext/phar/stream.c 				idata-&gt;fp = phar_get_pharfp(phar);</span>
<span class='curline'><a href='../S/966.html#L271'>phar</a>              271 ext/phar/stream.c 				idata-&gt;phar = phar;</span>
<span class='curline'><a href='../S/966.html#L273'>phar</a>              273 ext/phar/stream.c 				if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/966.html#L274'>phar</a>              274 ext/phar/stream.c 					++(entry-&gt;phar-&gt;refcount);</span>
<span class='curline'><a href='../S/966.html#L279'>phar</a>              279 ext/phar/stream.c 					*opened_path = strpprintf(MAXPATHLEN, "%s", phar-&gt;fname);</span>
<span class='curline'><a href='../S/966.html#L301'>phar</a>              301 ext/phar/stream.c 		fprintf(stderr, "Pharname:   %s\n", idata-&gt;phar-&gt;filename);</span>
<span class='curline'><a href='../S/966.html#L323'>phar</a>              323 ext/phar/stream.c 		if ((idata-&gt;phar-&gt;is_tar || idata-&gt;phar-&gt;is_zip) &amp;&amp; idata-&gt;internal_file-&gt;filename_len == sizeof(".phar/stub.php")-1 &amp;&amp; !strncmp(idata-&gt;internal_file-&gt;filename, ".phar/stub.php", sizeof(".phar/stub.php")-1)) {</span>
<span class='curline'><a href='../S/966.html#L336'>phar</a>              336 ext/phar/stream.c 		*opened_path = strpprintf(MAXPATHLEN, "phar://%s/%s", idata-&gt;phar-&gt;fname, idata-&gt;internal_file-&gt;filename);</span>
<span class='curline'><a href='../S/966.html#L443'>phar</a>              443 ext/phar/stream.c 		php_stream_wrapper_log_error(stream-&gt;wrapper, stream-&gt;flags, "phar error: Could not write %d characters to \"%s\" in phar \"%s\"", (int) count, data-&gt;internal_file-&gt;filename, data-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/966.html#L468'>phar</a>              468 ext/phar/stream.c 		ret = phar_flush(data-&gt;phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/966.html#L484'>phar</a>              484 ext/phar/stream.c void phar_dostat(phar_archive_data *phar, phar_entry_info *data, php_stream_statbuf *ssb, zend_bool is_temp_dir)</span>
<span class='curline'><a href='../S/966.html#L521'>phar</a>              521 ext/phar/stream.c 		ssb-&gt;sb.st_mtime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L522'>phar</a>              522 ext/phar/stream.c 		ssb-&gt;sb.st_atime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L523'>phar</a>              523 ext/phar/stream.c 		ssb-&gt;sb.st_ctime.tv_sec = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L525'>phar</a>              525 ext/phar/stream.c 		ssb-&gt;sb.st_mtime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L526'>phar</a>              526 ext/phar/stream.c 		ssb-&gt;sb.st_atime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L527'>phar</a>              527 ext/phar/stream.c 		ssb-&gt;sb.st_ctime = phar-&gt;max_timestamp;</span>
<span class='curline'><a href='../S/966.html#L530'>phar</a>              530 ext/phar/stream.c 	if (!phar-&gt;is_writeable) {</span>
<span class='curline'><a href='../S/966.html#L561'>phar</a>              561 ext/phar/stream.c 	phar_dostat(data-&gt;phar, data-&gt;internal_file, ssb, 0);</span>
<span class='curline'><a href='../S/966.html#L574'>phar</a>              574 ext/phar/stream.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/966.html#L599'>phar</a>              599 ext/phar/stream.c 	if (FAILURE == phar_get_archive(&amp;phar, resource-&gt;host, host_len, NULL, 0, &amp;error)) {</span>
<span class='curline'><a href='../S/966.html#L611'>phar</a>              611 ext/phar/stream.c 		phar_dostat(phar, NULL, ssb, 1);</span>
<span class='curline'><a href='../S/966.html#L615'>phar</a>              615 ext/phar/stream.c 	if (!phar-&gt;manifest.u.flags) {</span>
<span class='curline'><a href='../S/966.html#L621'>phar</a>              621 ext/phar/stream.c 	if (NULL != (entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, internal_file, internal_file_len))) {</span>
<span class='curline'><a href='../S/966.html#L622'>phar</a>              622 ext/phar/stream.c 		phar_dostat(phar, entry, ssb, 0);</span>
<span class='curline'><a href='../S/966.html#L626'>phar</a>              626 ext/phar/stream.c 	if (zend_hash_str_exists(&amp;(phar-&gt;virtual_dirs), internal_file, internal_file_len)) {</span>
<span class='curline'><a href='../S/966.html#L627'>phar</a>              627 ext/phar/stream.c 		phar_dostat(phar, NULL, ssb, 1);</span>
<span class='curline'><a href='../S/966.html#L632'>phar</a>              632 ext/phar/stream.c 	if (phar-&gt;mounted_dirs.u.flags &amp;&amp; zend_hash_num_elements(&amp;phar-&gt;mounted_dirs)) {</span>
<span class='curline'><a href='../S/966.html#L635'>phar</a>              635 ext/phar/stream.c 		ZEND_HASH_FOREACH_STR_KEY(&amp;phar-&gt;mounted_dirs, str_key) {</span>
<span class='curline'><a href='../S/966.html#L643'>phar</a>              643 ext/phar/stream.c 				if (NULL == (entry = zend_hash_find_ptr(&amp;phar-&gt;manifest, str_key))) {</span>
<span class='curline'><a href='../S/966.html#L655'>phar</a>              655 ext/phar/stream.c 				if (SUCCESS != phar_mount_entry(phar, test, test_len, internal_file, internal_file_len)) {</span>
<span class='curline'><a href='../S/966.html#L660'>phar</a>              660 ext/phar/stream.c 				if (NULL == (entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, internal_file, internal_file_len))) {</span>
<span class='curline'><a href='../S/966.html#L663'>phar</a>              663 ext/phar/stream.c 				phar_dostat(phar, entry, ssb, 0);</span>
<span class='curline'><a href='../S/966.html#L756'>phar</a>              756 ext/phar/stream.c 	phar_archive_data *phar, *pfrom, *pto;</span>
<span class='curline'><a href='../S/966.html#L835'>phar</a>              835 ext/phar/stream.c 	if (SUCCESS != phar_get_archive(&amp;phar, resource_from-&gt;host, host_len, NULL, 0, &amp;error)) {</span>
<span class='curline'><a href='../S/966.html#L843'>phar</a>              843 ext/phar/stream.c 	if (phar-&gt;is_persistent &amp;&amp; FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/966.html#L850'>phar</a>              850 ext/phar/stream.c 	if (NULL != (entry = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), resource_from-&gt;path+1, strlen(resource_from-&gt;path)-1))) {</span>
<span class='curline'><a href='../S/966.html#L870'>phar</a>              870 ext/phar/stream.c 		entry = zend_hash_str_add_mem(&amp;(phar-&gt;manifest), resource_to-&gt;path+1, strlen(resource_to-&gt;path)-1, (void **)&amp;new, sizeof(phar_entry_info));</span>
<span class='curline'><a href='../S/966.html#L878'>phar</a>              878 ext/phar/stream.c 			zend_hash_str_del(&amp;(phar-&gt;manifest), entry-&gt;filename, strlen(entry-&gt;filename));</span>
<span class='curline'><a href='../S/966.html#L886'>phar</a>              886 ext/phar/stream.c 		is_dir = zend_hash_str_exists(&amp;(phar-&gt;virtual_dirs), resource_from-&gt;path+1, strlen(resource_from-&gt;path)-1);</span>
<span class='curline'><a href='../S/966.html#L905'>phar</a>              905 ext/phar/stream.c 		ZEND_HASH_FOREACH_BUCKET(&amp;phar-&gt;manifest, b) {</span>
<span class='curline'><a href='../S/966.html#L930'>phar</a>              930 ext/phar/stream.c 		zend_hash_rehash(&amp;phar-&gt;manifest);</span>
<span class='curline'><a href='../S/966.html#L932'>phar</a>              932 ext/phar/stream.c 		ZEND_HASH_FOREACH_BUCKET(&amp;phar-&gt;virtual_dirs, b) {</span>
<span class='curline'><a href='../S/966.html#L948'>phar</a>              948 ext/phar/stream.c 		zend_hash_rehash(&amp;phar-&gt;virtual_dirs);</span>
<span class='curline'><a href='../S/966.html#L950'>phar</a>              950 ext/phar/stream.c 		ZEND_HASH_FOREACH_BUCKET(&amp;phar-&gt;mounted_dirs, b) {</span>
<span class='curline'><a href='../S/966.html#L966'>phar</a>              966 ext/phar/stream.c 		zend_hash_rehash(&amp;phar-&gt;mounted_dirs);</span>
<span class='curline'><a href='../S/966.html#L970'>phar</a>              970 ext/phar/stream.c 		phar_flush(phar, 0, 0, 0, &amp;error);</span>
<span class='curline'><a href='../S/969.html#L129'>phar</a>              129 ext/phar/tar.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/969.html#L130'>phar</a>              130 ext/phar/tar.c 	int ret = phar_create_or_parse_filename(fname, fname_len, alias, alias_len, is_data, options, &amp;phar, error);</span>
<span class='curline'><a href='../S/969.html#L137'>phar</a>              137 ext/phar/tar.c 		*pphar = phar;</span>
<span class='curline'><a href='../S/969.html#L140'>phar</a>              140 ext/phar/tar.c 	phar-&gt;is_data = is_data;</span>
<span class='curline'><a href='../S/969.html#L142'>phar</a>              142 ext/phar/tar.c 	if (phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/969.html#L146'>phar</a>              146 ext/phar/tar.c 	if (phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/969.html#L147'>phar</a>              147 ext/phar/tar.c 		phar-&gt;is_tar = 1;</span>
<span class='curline'><a href='../S/969.html#L148'>phar</a>              148 ext/phar/tar.c 		phar-&gt;is_zip = 0;</span>
<span class='curline'><a href='../S/969.html#L149'>phar</a>              149 ext/phar/tar.c 		phar-&gt;internal_file_start = 0;</span>
<span class='curline'><a href='../S/969.html#L184'>phar</a>              184 ext/phar/tar.c 		entry-&gt;phar-&gt;metadata = entry-&gt;metadata;</span>
<span class='curline'><a href='../S/969.html#L186'>phar</a>              186 ext/phar/tar.c 	} else if (entry-&gt;filename_len &gt;= sizeof(".phar/.metadata/") + sizeof("/.metadata.bin") - 1 &amp;&amp; NULL != (mentry = zend_hash_str_find_ptr(&amp;(entry-&gt;phar-&gt;manifest), entry-&gt;filename + sizeof(".phar/.metadata/") - 1, entry-&gt;filename_len - (sizeof("/.metadata.bin") - 1 + sizeof(".phar/.metadata/") - 1)))) {</span>
<span class='curline'><a href='../S/969.html#L251'>phar</a>              251 ext/phar/tar.c 	entry.phar = myphar;</span>
<span class='curline'><a href='../S/969.html#L718'>phar</a>              718 ext/phar/tar.c 	phar_add_virtual_dirs(entry-&gt;phar, entry-&gt;filename, entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/969.html#L725'>phar</a>              725 ext/phar/tar.c 				spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, filename \"%s\" is too long for tar file format", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L735'>phar</a>              735 ext/phar/tar.c 				spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, filename \"%s\" is too long for tar file format", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L749'>phar</a>              749 ext/phar/tar.c 			spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, filename \"%s\" is too large for tar file format", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L756'>phar</a>              756 ext/phar/tar.c 			spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, file modification time of file \"%s\" is too large for tar file format", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L775'>phar</a>              775 ext/phar/tar.c 			spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, checksum of file \"%s\" is too large for tar file format", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L785'>phar</a>              785 ext/phar/tar.c 			spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, header for  file \"%s\" could not be written", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L800'>phar</a>              800 ext/phar/tar.c 				spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, contents of file \"%s\" could not be written, seek failed", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L807'>phar</a>              807 ext/phar/tar.c 				spprintf(fp-&gt;error, 4096, "tar-based phar \"%s\" cannot be created, contents of file \"%s\" could not be written", entry-&gt;phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/969.html#L831'>phar</a>              831 ext/phar/tar.c 	if (entry-&gt;fp_type == PHAR_MOD &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;fp &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/969.html#L880'>phar</a>              880 ext/phar/tar.c 		zend_hash_str_del(&amp;(entry-&gt;phar-&gt;manifest), entry-&gt;filename, entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/969.html#L897'>phar</a>              897 ext/phar/tar.c 			return phar_tar_setmetadata(&amp;entry-&gt;phar-&gt;metadata, entry, error);</span>
<span class='curline'><a href='../S/969.html#L900'>phar</a>              900 ext/phar/tar.c 		if (entry-&gt;filename_len &gt;= sizeof(".phar/.metadata/") + sizeof("/.metadata.bin") - 1 &amp;&amp; !zend_hash_str_exists(&amp;(entry-&gt;phar-&gt;manifest), entry-&gt;filename + sizeof(".phar/.metadata/") - 1, entry-&gt;filename_len - (sizeof("/.metadata.bin") - 1 + sizeof(".phar/.metadata/") - 1))) {</span>
<span class='curline'><a href='../S/969.html#L916'>phar</a>              916 ext/phar/tar.c 		zend_hash_str_del(&amp;(entry-&gt;phar-&gt;manifest), lookfor, lookfor_len);</span>
<span class='curline'><a href='../S/969.html#L921'>phar</a>              921 ext/phar/tar.c 	if (NULL != (metadata = zend_hash_str_find_ptr(&amp;(entry-&gt;phar-&gt;manifest), lookfor, lookfor_len))) {</span>
<span class='curline'><a href='../S/969.html#L930'>phar</a>              930 ext/phar/tar.c 	newentry.phar = entry-&gt;phar;</span>
<span class='curline'><a href='../S/969.html#L934'>phar</a>              934 ext/phar/tar.c 	if (NULL == (metadata = zend_hash_str_add_mem(&amp;(entry-&gt;phar-&gt;manifest), lookfor, lookfor_len, (void *)&amp;newentry, sizeof(phar_entry_info)))) {</span>
<span class='curline'><a href='../S/969.html#L944'>phar</a>              944 ext/phar/tar.c int phar_tar_flush(phar_archive_data *phar, char *user_stub, zend_long len, int defaultstub, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/969.html#L960'>phar</a>              960 ext/phar/tar.c 	entry.phar = phar;</span>
<span class='curline'><a href='../S/969.html#L963'>phar</a>              963 ext/phar/tar.c 	if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/969.html#L965'>phar</a>              965 ext/phar/tar.c 			spprintf(error, 0, "internal error: attempt to flush cached tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L970'>phar</a>              970 ext/phar/tar.c 	if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/969.html#L975'>phar</a>              975 ext/phar/tar.c 	if (!phar-&gt;is_temporary_alias &amp;&amp; phar-&gt;alias_len) {</span>
<span class='curline'><a href='../S/969.html#L983'>phar</a>              983 ext/phar/tar.c 		if (phar-&gt;alias_len != (int)php_stream_write(entry.fp, phar-&gt;alias, phar-&gt;alias_len)) {</span>
<span class='curline'><a href='../S/969.html#L985'>phar</a>              985 ext/phar/tar.c 				spprintf(error, 0, "unable to set alias in tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L990'>phar</a>              990 ext/phar/tar.c 		entry.uncompressed_filesize = phar-&gt;alias_len;</span>
<span class='curline'><a href='../S/969.html#L992'>phar</a>              992 ext/phar/tar.c 		if (NULL == zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/969.html#L994'>phar</a>              994 ext/phar/tar.c 				spprintf(error, 0, "unable to set alias in tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L999'>phar</a>              999 ext/phar/tar.c 		zend_hash_str_del(&amp;phar-&gt;manifest, ".phar/alias.txt", sizeof(".phar/alias.txt")-1);</span>
<span class='curline'><a href='../S/969.html#L1009'>phar</a>             1009 ext/phar/tar.c 					spprintf(error, 0, "unable to access resource to copy stub to new tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1036'>phar</a>             1036 ext/phar/tar.c 					spprintf(error, 0, "unable to read resource to copy stub to new tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1049'>phar</a>             1049 ext/phar/tar.c 				spprintf(error, 0, "illegal stub for tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1070'>phar</a>             1070 ext/phar/tar.c 				spprintf(error, 0, "unable to create stub from string in new tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1081'>phar</a>             1081 ext/phar/tar.c 		zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info));</span>
<span class='curline'><a href='../S/969.html#L1096'>phar</a>             1096 ext/phar/tar.c 				spprintf(error, 0, "unable to %s stub in%star-based phar \"%s\", failed", user_stub ? "overwrite" : "create", user_stub ? " " : " new ", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1106'>phar</a>             1106 ext/phar/tar.c 			if (!zend_hash_str_exists(&amp;phar-&gt;manifest, ".phar/stub.php", sizeof(".phar/stub.php")-1)) {</span>
<span class='curline'><a href='../S/969.html#L1107'>phar</a>             1107 ext/phar/tar.c 				if (NULL == zend_hash_str_add_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/969.html#L1111'>phar</a>             1111 ext/phar/tar.c 						spprintf(error, 0, "unable to create stub in tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1120'>phar</a>             1120 ext/phar/tar.c 			if (NULL == zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/969.html#L1124'>phar</a>             1124 ext/phar/tar.c 					spprintf(error, 0, "unable to overwrite stub in tar-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1131'>phar</a>             1131 ext/phar/tar.c 	if (phar-&gt;fp &amp;&amp; !phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/969.html#L1132'>phar</a>             1132 ext/phar/tar.c 		oldfile = phar-&gt;fp;</span>
<span class='curline'><a href='../S/969.html#L1136'>phar</a>             1136 ext/phar/tar.c 		oldfile = php_stream_open_wrapper(phar-&gt;fname, "rb", 0, NULL);</span>
<span class='curline'><a href='../S/969.html#L1157'>phar</a>             1157 ext/phar/tar.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/969.html#L1159'>phar</a>             1159 ext/phar/tar.c 		if (NULL != (mentry = zend_hash_str_find_ptr(&amp;(phar-&gt;manifest), ".phar/.metadata.bin", sizeof(".phar/.metadata.bin")-1))) {</span>
<span class='curline'><a href='../S/969.html#L1160'>phar</a>             1160 ext/phar/tar.c 			if (ZEND_HASH_APPLY_KEEP != phar_tar_setmetadata(&amp;phar-&gt;metadata, mentry, error)) {</span>
<span class='curline'><a href='../S/969.html#L1171'>phar</a>             1171 ext/phar/tar.c 			newentry.phar = phar;</span>
<span class='curline'><a href='../S/969.html#L1175'>phar</a>             1175 ext/phar/tar.c 			if (NULL == (mentry = zend_hash_str_add_mem(&amp;(phar-&gt;manifest), ".phar/.metadata.bin", sizeof(".phar/.metadata.bin")-1, (void *)&amp;newentry, sizeof(phar_entry_info)))) {</span>
<span class='curline'><a href='../S/969.html#L1176'>phar</a>             1176 ext/phar/tar.c 				spprintf(error, 0, "phar tar error: unable to add magic metadata file to manifest for phar archive \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1183'>phar</a>             1183 ext/phar/tar.c 			if (ZEND_HASH_APPLY_KEEP != phar_tar_setmetadata(&amp;phar-&gt;metadata, mentry, error)) {</span>
<span class='curline'><a href='../S/969.html#L1184'>phar</a>             1184 ext/phar/tar.c 				zend_hash_str_del(&amp;(phar-&gt;manifest), ".phar/.metadata.bin", sizeof(".phar/.metadata.bin")-1);</span>
<span class='curline'><a href='../S/969.html#L1193'>phar</a>             1193 ext/phar/tar.c 	zend_hash_apply_with_argument(&amp;phar-&gt;manifest, phar_tar_setupmetadata, (void *) &amp;pass);</span>
<span class='curline'><a href='../S/969.html#L1205'>phar</a>             1205 ext/phar/tar.c 	zend_hash_apply_with_argument(&amp;phar-&gt;manifest, phar_tar_writeheaders, (void *) &amp;pass);</span>
<span class='curline'><a href='../S/969.html#L1208'>phar</a>             1208 ext/phar/tar.c 	if (!phar-&gt;is_data || phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/969.html#L1209'>phar</a>             1209 ext/phar/tar.c 		if (FAILURE == phar_create_signature(phar, newfile, &amp;signature, &amp;signature_length, error)) {</span>
<span class='curline'><a href='../S/969.html#L1240'>phar</a>             1240 ext/phar/tar.c 		PHAR_SET_32(sigbuf, phar-&gt;sig_flags);</span>
<span class='curline'><a href='../S/969.html#L1246'>phar</a>             1246 ext/phar/tar.c 				spprintf(error, 0, "phar error: unable to write signature to tar-based phar %s", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1286'>phar</a>             1286 ext/phar/tar.c 	if (phar-&gt;fp &amp;&amp; pass.free_fp) {</span>
<span class='curline'><a href='../S/969.html#L1287'>phar</a>             1287 ext/phar/tar.c 		php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/969.html#L1290'>phar</a>             1290 ext/phar/tar.c 	if (phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/969.html#L1292'>phar</a>             1292 ext/phar/tar.c 			php_stream_close(phar-&gt;ufp);</span>
<span class='curline'><a href='../S/969.html#L1294'>phar</a>             1294 ext/phar/tar.c 		phar-&gt;ufp = NULL;</span>
<span class='curline'><a href='../S/969.html#L1297'>phar</a>             1297 ext/phar/tar.c 	phar-&gt;is_brandnew = 0;</span>
<span class='curline'><a href='../S/969.html#L1300'>phar</a>             1300 ext/phar/tar.c 	if (phar-&gt;donotflush) {</span>
<span class='curline'><a href='../S/969.html#L1302'>phar</a>             1302 ext/phar/tar.c 		phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/969.html#L1304'>phar</a>             1304 ext/phar/tar.c 		phar-&gt;fp = php_stream_open_wrapper(phar-&gt;fname, "w+b", IGNORE_URL|STREAM_MUST_SEEK|REPORT_ERRORS, NULL);</span>
<span class='curline'><a href='../S/969.html#L1305'>phar</a>             1305 ext/phar/tar.c 		if (!phar-&gt;fp) {</span>
<span class='curline'><a href='../S/969.html#L1306'>phar</a>             1306 ext/phar/tar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/969.html#L1308'>phar</a>             1308 ext/phar/tar.c 				spprintf(error, 0, "unable to open new phar \"%s\" for writing", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1313'>phar</a>             1313 ext/phar/tar.c 		if (phar-&gt;flags &amp; PHAR_FILE_COMPRESSED_GZ) {</span>
<span class='curline'><a href='../S/969.html#L1324'>phar</a>             1324 ext/phar/tar.c 			filter = php_stream_filter_create("zlib.deflate", &amp;filterparams, php_stream_is_persistent(phar-&gt;fp));</span>
<span class='curline'><a href='../S/969.html#L1329'>phar</a>             1329 ext/phar/tar.c 				php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/969.html#L1332'>phar</a>             1332 ext/phar/tar.c 					spprintf(error, 4096, "unable to compress all contents of phar \"%s\" using zlib, PHP versions older than 5.2.6 have a buggy zlib", phar-&gt;fname);</span>
<span class='curline'><a href='../S/969.html#L1337'>phar</a>             1337 ext/phar/tar.c 			php_stream_filter_append(&amp;phar-&gt;fp-&gt;writefilters, filter);</span>
<span class='curline'><a href='../S/969.html#L1338'>phar</a>             1338 ext/phar/tar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/969.html#L1341'>phar</a>             1341 ext/phar/tar.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/969.html#L1343'>phar</a>             1343 ext/phar/tar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/969.html#L1344'>phar</a>             1344 ext/phar/tar.c 		} else if (phar-&gt;flags &amp; PHAR_FILE_COMPRESSED_BZ2) {</span>
<span class='curline'><a href='../S/969.html#L1347'>phar</a>             1347 ext/phar/tar.c 			filter = php_stream_filter_create("bzip2.compress", NULL, php_stream_is_persistent(phar-&gt;fp));</span>
<span class='curline'><a href='../S/969.html#L1348'>phar</a>             1348 ext/phar/tar.c 			php_stream_filter_append(&amp;phar-&gt;fp-&gt;writefilters, filter);</span>
<span class='curline'><a href='../S/969.html#L1349'>phar</a>             1349 ext/phar/tar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/969.html#L1352'>phar</a>             1352 ext/phar/tar.c 			php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/969.html#L1354'>phar</a>             1354 ext/phar/tar.c 			phar-&gt;fp = newfile;</span>
<span class='curline'><a href='../S/969.html#L1356'>phar</a>             1356 ext/phar/tar.c 			php_stream_copy_to_stream_ex(newfile, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
<span class='curline'><a href='../S/971.html#L74'>phar</a>               74 ext/phar/util.c 	if (NULL != (link_entry = zend_hash_str_find_ptr(&amp;(entry-&gt;phar-&gt;manifest), entry-&gt;link, strlen(entry-&gt;link))) ||</span>
<span class='curline'><a href='../S/971.html#L75'>phar</a>               75 ext/phar/util.c 		NULL != (link_entry = zend_hash_str_find_ptr(&amp;(entry-&gt;phar-&gt;manifest), link, strlen(link)))) {</span>
<span class='curline'><a href='../S/971.html#L103'>phar</a>              103 ext/phar/util.c 			phar_open_archive_fp(entry-&gt;phar);</span>
<span class='curline'><a href='../S/971.html#L170'>phar</a>              170 ext/phar/util.c int phar_mount_entry(phar_archive_data *phar, char *filename, int filename_len, char *path, int path_len) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L188'>phar</a>              188 ext/phar/util.c 	entry.phar = phar;</span>
<span class='curline'><a href='../S/971.html#L230'>phar</a>              230 ext/phar/util.c 		if (NULL == zend_hash_str_add_ptr(&amp;phar-&gt;mounted_dirs, entry.filename, path_len, entry.filename)) {</span>
<span class='curline'><a href='../S/971.html#L243'>phar</a>              243 ext/phar/util.c 	if (NULL != zend_hash_str_add_mem(&amp;phar-&gt;manifest, entry.filename, path_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/971.html#L258'>phar</a>              258 ext/phar/util.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/971.html#L263'>phar</a>              263 ext/phar/util.c 		pphar = &amp;phar;</span>
<span class='curline'><a href='../S/971.html#L276'>phar</a>              276 ext/phar/util.c 		phar = PHAR_G(last_phar);</span>
<span class='curline'><a href='../S/971.html#L289'>phar</a>              289 ext/phar/util.c 		if (FAILURE == phar_get_archive(&amp;phar, arch, arch_len, NULL, 0, NULL)) {</span>
<span class='curline'><a href='../S/971.html#L295'>phar</a>              295 ext/phar/util.c 			*pphar = phar;</span>
<span class='curline'><a href='../S/971.html#L302'>phar</a>              302 ext/phar/util.c 			if (zend_hash_str_exists(&amp;(phar-&gt;manifest), test + 1, try_len - 1)) {</span>
<span class='curline'><a href='../S/971.html#L309'>phar</a>              309 ext/phar/util.c 			if (zend_hash_str_exists(&amp;(phar-&gt;manifest), test, try_len)) {</span>
<span class='curline'><a href='../S/971.html#L354'>phar</a>              354 ext/phar/util.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/971.html#L371'>phar</a>              371 ext/phar/util.c 	if (FAILURE == phar_get_archive(&amp;phar, fname, fname_len, NULL, 0, error)) {</span>
<span class='curline'><a href='../S/971.html#L375'>phar</a>              375 ext/phar/util.c 	if (for_write &amp;&amp; PHAR_G(readonly) &amp;&amp; !phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/971.html#L390'>phar</a>              390 ext/phar/util.c 		if ((entry = phar_get_entry_info_dir(phar, path, path_len, allow_dir, for_create &amp;&amp; !PHAR_G(readonly) &amp;&amp; !phar-&gt;is_data ? NULL : error, security)) == NULL) {</span>
<span class='curline'><a href='../S/971.html#L391'>phar</a>              391 ext/phar/util.c 			if (for_create &amp;&amp; (!PHAR_G(readonly) || phar-&gt;is_data)) {</span>
<span class='curline'><a href='../S/971.html#L397'>phar</a>              397 ext/phar/util.c 		if ((entry = phar_get_entry_info(phar, path, path_len, for_create &amp;&amp; !PHAR_G(readonly) &amp;&amp; !phar-&gt;is_data ? NULL : error, security)) == NULL) {</span>
<span class='curline'><a href='../S/971.html#L398'>phar</a>              398 ext/phar/util.c 			if (for_create &amp;&amp; (!PHAR_G(readonly) || phar-&gt;is_data)) {</span>
<span class='curline'><a href='../S/971.html#L405'>phar</a>              405 ext/phar/util.c 	if (for_write &amp;&amp; phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/971.html#L406'>phar</a>              406 ext/phar/util.c 		if (FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/971.html#L441'>phar</a>              441 ext/phar/util.c 		(*ret)-&gt;phar = phar;</span>
<span class='curline'><a href='../S/971.html#L447'>phar</a>              447 ext/phar/util.c 		if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/971.html#L448'>phar</a>              448 ext/phar/util.c 			++(entry-&gt;phar-&gt;refcount);</span>
<span class='curline'><a href='../S/971.html#L457'>phar</a>              457 ext/phar/util.c 			if (FAILURE == phar_create_writeable_entry(phar, entry, error)) {</span>
<span class='curline'><a href='../S/971.html#L472'>phar</a>              472 ext/phar/util.c 				if (FAILURE == phar_create_writeable_entry(phar, entry, error)) {</span>
<span class='curline'><a href='../S/971.html#L489'>phar</a>              489 ext/phar/util.c 	(*ret)-&gt;phar = phar;</span>
<span class='curline'><a href='../S/971.html#L506'>phar</a>              506 ext/phar/util.c 	if (!phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/971.html#L508'>phar</a>              508 ext/phar/util.c 		++(entry-&gt;phar-&gt;refcount);</span>
<span class='curline'><a href='../S/971.html#L520'>phar</a>              520 ext/phar/util.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/971.html#L532'>phar</a>              532 ext/phar/util.c 	if (FAILURE == phar_get_archive(&amp;phar, fname, fname_len, NULL, 0, error)) {</span>
<span class='curline'><a href='../S/971.html#L549'>phar</a>              549 ext/phar/util.c 	if (phar-&gt;is_persistent &amp;&amp; FAILURE == phar_copy_on_write(&amp;phar)) {</span>
<span class='curline'><a href='../S/971.html#L586'>phar</a>              586 ext/phar/util.c 	phar_add_virtual_dirs(phar, path, path_len);</span>
<span class='curline'><a href='../S/971.html#L590'>phar</a>              590 ext/phar/util.c 	etemp.phar = phar;</span>
<span class='curline'><a href='../S/971.html#L592'>phar</a>              592 ext/phar/util.c 	etemp.is_zip = phar-&gt;is_zip;</span>
<span class='curline'><a href='../S/971.html#L594'>phar</a>              594 ext/phar/util.c 	if (phar-&gt;is_tar) {</span>
<span class='curline'><a href='../S/971.html#L595'>phar</a>              595 ext/phar/util.c 		etemp.is_tar = phar-&gt;is_tar;</span>
<span class='curline'><a href='../S/971.html#L599'>phar</a>              599 ext/phar/util.c 	if (NULL == (entry = zend_hash_str_add_mem(&amp;phar-&gt;manifest, etemp.filename, path_len, (void*)&amp;etemp, sizeof(phar_entry_info)))) {</span>
<span class='curline'><a href='../S/971.html#L602'>phar</a>              602 ext/phar/util.c 			spprintf(error, 0, "phar error: unable to add new entry \"%s\" to phar \"%s\"", etemp.filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L616'>phar</a>              616 ext/phar/util.c 	++(phar-&gt;refcount);</span>
<span class='curline'><a href='../S/971.html#L617'>phar</a>              617 ext/phar/util.c 	ret-&gt;phar = phar;</span>
<span class='curline'><a href='../S/971.html#L630'>phar</a>              630 ext/phar/util.c int phar_open_archive_fp(phar_archive_data *phar) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L632'>phar</a>              632 ext/phar/util.c 	if (phar_get_pharfp(phar)) {</span>
<span class='curline'><a href='../S/971.html#L636'>phar</a>              636 ext/phar/util.c 	if (php_check_open_basedir(phar-&gt;fname)) {</span>
<span class='curline'><a href='../S/971.html#L640'>phar</a>              640 ext/phar/util.c 	phar_set_pharfp(phar, php_stream_open_wrapper(phar-&gt;fname, "rb", IGNORE_URL|STREAM_MUST_SEEK|0, NULL));</span>
<span class='curline'><a href='../S/971.html#L642'>phar</a>              642 ext/phar/util.c 	if (!phar_get_pharfp(phar)) {</span>
<span class='curline'><a href='../S/971.html#L684'>phar</a>              684 ext/phar/util.c 			spprintf(error, 4096, "phar error: unable to copy contents of file \"%s\" to \"%s\" in phar archive \"%s\"", source-&gt;filename, dest-&gt;filename, source-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L698'>phar</a>              698 ext/phar/util.c 	phar_archive_data *phar = entry-&gt;phar;</span>
<span class='curline'><a href='../S/971.html#L727'>phar</a>              727 ext/phar/util.c 	if (!phar_get_pharfp(phar)) {</span>
<span class='curline'><a href='../S/971.html#L728'>phar</a>              728 ext/phar/util.c 		if (FAILURE == phar_open_archive_fp(phar)) {</span>
<span class='curline'><a href='../S/971.html#L729'>phar</a>              729 ext/phar/util.c 			spprintf(error, 4096, "phar error: Cannot open phar archive \"%s\" for reading", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L736'>phar</a>              736 ext/phar/util.c 		dummy.phar = phar;</span>
<span class='curline'><a href='../S/971.html#L738'>phar</a>              738 ext/phar/util.c 		dummy.fp = phar_get_pharfp(phar);</span>
<span class='curline'><a href='../S/971.html#L748'>phar</a>              748 ext/phar/util.c 			spprintf(error, 4096, "phar error: Cannot open temporary file for decompressing phar archive \"%s\" file \"%s\"", phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/971.html#L754'>phar</a>              754 ext/phar/util.c 	dummy.phar = phar;</span>
<span class='curline'><a href='../S/971.html#L756'>phar</a>              756 ext/phar/util.c 	dummy.fp = phar_get_pharfp(phar);</span>
<span class='curline'><a href='../S/971.html#L770'>phar</a>              770 ext/phar/util.c 		spprintf(error, 4096, "phar error: unable to read phar \"%s\" (cannot create %s filter while decompressing file \"%s\")", phar-&gt;fname, phar_decompress_filter(entry, 1), entry-&gt;filename);</span>
<span class='curline'><a href='../S/971.html#L783'>phar</a>              783 ext/phar/util.c 			spprintf(error, 4096, "phar error: internal corruption of phar \"%s\" (actual filesize mismatch on file \"%s\")", phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/971.html#L794'>phar</a>              794 ext/phar/util.c 		spprintf(error, 4096, "phar error: internal corruption of phar \"%s\" (actual filesize mismatch on file \"%s\")", phar-&gt;fname, entry-&gt;filename);</span>
<span class='curline'><a href='../S/971.html#L811'>phar</a>              811 ext/phar/util.c int phar_create_writeable_entry(phar_archive_data *phar, phar_entry_info *entry, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L819'>phar</a>              819 ext/phar/util.c 		phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/971.html#L852'>phar</a>              852 ext/phar/util.c 	phar-&gt;is_modified = 1;</span>
<span class='curline'><a href='../S/971.html#L891'>phar</a>              891 ext/phar/util.c 			spprintf(error, 4096, "phar error: cannot separate entry file \"%s\" contents in phar archive \"%s\" for write access", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L913'>phar</a>              913 ext/phar/util.c phar_entry_info * phar_open_jit(phar_archive_data *phar, phar_entry_info *entry, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L923'>phar</a>              923 ext/phar/util.c 		spprintf(error, 4096, "phar error: cannot seek to start of file \"%s\" in phar \"%s\"", entry-&gt;filename, phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L942'>phar</a>              942 ext/phar/util.c int phar_free_alias(phar_archive_data *phar, char *alias, int alias_len) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L944'>phar</a>              944 ext/phar/util.c 	if (phar-&gt;refcount || phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/971.html#L949'>phar</a>              949 ext/phar/util.c 	if (zend_hash_str_del(&amp;(PHAR_G(phar_fname_map)), phar-&gt;fname, phar-&gt;fname_len) != SUCCESS) {</span>
<span class='curline'><a href='../S/971.html#L1209'>phar</a>             1209 ext/phar/util.c phar_entry_info *phar_get_entry_info(phar_archive_data *phar, char *path, int path_len, char **error, int security) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L1211'>phar</a>             1211 ext/phar/util.c 	return phar_get_entry_info_dir(phar, path, path_len, 0, error, security);</span>
<span class='curline'><a href='../S/971.html#L1219'>phar</a>             1219 ext/phar/util.c phar_entry_info *phar_get_entry_info_dir(phar_archive_data *phar, char *path, int path_len, char dir, char **error, int security) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L1256'>phar</a>             1256 ext/phar/util.c 	if (!phar-&gt;manifest.u.flags) {</span>
<span class='curline'><a href='../S/971.html#L1267'>phar</a>             1267 ext/phar/util.c 	if (NULL != (entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, path, path_len))) {</span>
<span class='curline'><a href='../S/971.html#L1289'>phar</a>             1289 ext/phar/util.c 		if (zend_hash_str_exists(&amp;phar-&gt;virtual_dirs, path, path_len)) {</span>
<span class='curline'><a href='../S/971.html#L1296'>phar</a>             1296 ext/phar/util.c 			entry-&gt;phar = phar;</span>
<span class='curline'><a href='../S/971.html#L1301'>phar</a>             1301 ext/phar/util.c 	if (phar-&gt;mounted_dirs.u.flags &amp;&amp; zend_hash_num_elements(&amp;phar-&gt;mounted_dirs)) {</span>
<span class='curline'><a href='../S/971.html#L1304'>phar</a>             1304 ext/phar/util.c 		ZEND_HASH_FOREACH_STR_KEY(&amp;phar-&gt;mounted_dirs, str_key) {</span>
<span class='curline'><a href='../S/971.html#L1312'>phar</a>             1312 ext/phar/util.c 				if (NULL == (entry = zend_hash_find_ptr(&amp;phar-&gt;manifest, str_key))) {</span>
<span class='curline'><a href='../S/971.html#L1351'>phar</a>             1351 ext/phar/util.c 				if (SUCCESS != phar_mount_entry(phar, test, test_len, path, path_len)) {</span>
<span class='curline'><a href='../S/971.html#L1361'>phar</a>             1361 ext/phar/util.c 				if (NULL == (entry = zend_hash_str_find_ptr(&amp;phar-&gt;manifest, path, path_len))) {</span>
<span class='curline'><a href='../S/971.html#L1758'>phar</a>             1758 ext/phar/util.c int phar_create_signature(phar_archive_data *phar, php_stream *fp, char **signature, int *signature_length, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L1765'>phar</a>             1765 ext/phar/util.c 	if (phar-&gt;signature) {</span>
<span class='curline'><a href='../S/971.html#L1766'>phar</a>             1766 ext/phar/util.c 		efree(phar-&gt;signature);</span>
<span class='curline'><a href='../S/971.html#L1767'>phar</a>             1767 ext/phar/util.c 		phar-&gt;signature = NULL;</span>
<span class='curline'><a href='../S/971.html#L1770'>phar</a>             1770 ext/phar/util.c 	switch(phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/971.html#L1806'>phar</a>             1806 ext/phar/util.c 				spprintf(error, 0, "unable to write to phar \"%s\" with requested hash type", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1823'>phar</a>             1823 ext/phar/util.c 					spprintf(error, 0, "unable to write to phar \"%s\" with requested openssl signature", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1846'>phar</a>             1846 ext/phar/util.c 					spprintf(error, 0, "unable to initialize openssl signature for phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1855'>phar</a>             1855 ext/phar/util.c 						spprintf(error, 0, "unable to update the openssl signature for phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1864'>phar</a>             1864 ext/phar/util.c 					spprintf(error, 0, "unable to write phar \"%s\" with requested openssl signature", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1878'>phar</a>             1878 ext/phar/util.c 					spprintf(error, 0, "unable to write phar \"%s\" with requested openssl signature", phar-&gt;fname);</span>
<span class='curline'><a href='../S/971.html#L1888'>phar</a>             1888 ext/phar/util.c 			phar-&gt;sig_flags = PHAR_SIG_SHA1;</span>
<span class='curline'><a href='../S/971.html#L1921'>phar</a>             1921 ext/phar/util.c 	phar-&gt;sig_len = phar_hex_str((const char *)*signature, *signature_length, &amp;phar-&gt;signature);</span>
<span class='curline'><a href='../S/971.html#L1926'>phar</a>             1926 ext/phar/util.c void phar_add_virtual_dirs(phar_archive_data *phar, char *filename, int filename_len) /* {{{ */</span>
<span class='curline'><a href='../S/971.html#L1932'>phar</a>             1932 ext/phar/util.c 		if (!filename_len || NULL == zend_hash_str_add_empty_element(&amp;phar-&gt;virtual_dirs, filename, filename_len)) {</span>
<span class='curline'><a href='../S/971.html#L1943'>phar</a>             1943 ext/phar/util.c 	entry-&gt;phar = (phar_archive_data *)argument;</span>
<span class='curline'><a href='../S/971.html#L1982'>phar</a>             1982 ext/phar/util.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/971.html#L1987'>phar</a>             1987 ext/phar/util.c 	phar = (phar_archive_data *) emalloc(sizeof(phar_archive_data));</span>
<span class='curline'><a href='../S/971.html#L1988'>phar</a>             1988 ext/phar/util.c 	*phar = **pphar;</span>
<span class='curline'><a href='../S/971.html#L1989'>phar</a>             1989 ext/phar/util.c 	phar-&gt;is_persistent = 0;</span>
<span class='curline'><a href='../S/971.html#L1990'>phar</a>             1990 ext/phar/util.c 	fname = phar-&gt;fname;</span>
<span class='curline'><a href='../S/971.html#L1991'>phar</a>             1991 ext/phar/util.c 	phar-&gt;fname = estrndup(phar-&gt;fname, phar-&gt;fname_len);</span>
<span class='curline'><a href='../S/971.html#L1992'>phar</a>             1992 ext/phar/util.c 	phar-&gt;ext = phar-&gt;fname + (phar-&gt;ext - fname);</span>
<span class='curline'><a href='../S/971.html#L1994'>phar</a>             1994 ext/phar/util.c 	if (phar-&gt;alias) {</span>
<span class='curline'><a href='../S/971.html#L1995'>phar</a>             1995 ext/phar/util.c 		phar-&gt;alias = estrndup(phar-&gt;alias, phar-&gt;alias_len);</span>
<span class='curline'><a href='../S/971.html#L1998'>phar</a>             1998 ext/phar/util.c 	if (phar-&gt;signature) {</span>
<span class='curline'><a href='../S/971.html#L1999'>phar</a>             1999 ext/phar/util.c 		phar-&gt;signature = estrdup(phar-&gt;signature);</span>
<span class='curline'><a href='../S/971.html#L2002'>phar</a>             2002 ext/phar/util.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/971.html#L2004'>phar</a>             2004 ext/phar/util.c 		if (phar-&gt;metadata_len) {</span>
<span class='curline'><a href='../S/971.html#L2005'>phar</a>             2005 ext/phar/util.c 			char *buf = estrndup((char *) Z_PTR(phar-&gt;metadata), phar-&gt;metadata_len);</span>
<span class='curline'><a href='../S/971.html#L2006'>phar</a>             2006 ext/phar/util.c 			phar_parse_metadata(&amp;buf, &amp;phar-&gt;metadata, phar-&gt;metadata_len);</span>
<span class='curline'><a href='../S/971.html#L2009'>phar</a>             2009 ext/phar/util.c 			zval_copy_ctor(&amp;phar-&gt;metadata);</span>
<span class='curline'><a href='../S/971.html#L2016'>phar</a>             2016 ext/phar/util.c 	zend_hash_apply_with_argument(&amp;newmanifest, phar_update_cached_entry, (void *)phar);</span>
<span class='curline'><a href='../S/971.html#L2017'>phar</a>             2017 ext/phar/util.c 	phar-&gt;manifest = newmanifest;</span>
<span class='curline'><a href='../S/971.html#L2018'>phar</a>             2018 ext/phar/util.c 	zend_hash_init(&amp;phar-&gt;mounted_dirs, sizeof(char *),</span>
<span class='curline'><a href='../S/971.html#L2020'>phar</a>             2020 ext/phar/util.c 	zend_hash_init(&amp;phar-&gt;virtual_dirs, sizeof(char *),</span>
<span class='curline'><a href='../S/971.html#L2022'>phar</a>             2022 ext/phar/util.c 	zend_hash_copy(&amp;phar-&gt;virtual_dirs, &amp;(*pphar)-&gt;virtual_dirs, NULL);</span>
<span class='curline'><a href='../S/971.html#L2023'>phar</a>             2023 ext/phar/util.c 	*pphar = phar;</span>
<span class='curline'><a href='../S/971.html#L2027'>phar</a>             2027 ext/phar/util.c 		if (objphar-&gt;archive-&gt;fname_len == phar-&gt;fname_len &amp;&amp; !memcmp(objphar-&gt;archive-&gt;fname, phar-&gt;fname, phar-&gt;fname_len)) {</span>
<span class='curline'><a href='../S/971.html#L2028'>phar</a>             2028 ext/phar/util.c 			objphar-&gt;archive = phar;</span>
<span class='curline'><a href='../S/972.html#L290'>phar</a>              290 ext/phar/zip.c 	entry.phar = mydata;</span>
<span class='curline'><a href='../S/972.html#L746'>phar</a>              746 ext/phar/zip.c 	phar_archive_data *phar;</span>
<span class='curline'><a href='../S/972.html#L747'>phar</a>              747 ext/phar/zip.c 	int ret = phar_create_or_parse_filename(fname, fname_len, alias, alias_len, is_data, options, &amp;phar, error);</span>
<span class='curline'><a href='../S/972.html#L754'>phar</a>              754 ext/phar/zip.c 		*pphar = phar;</span>
<span class='curline'><a href='../S/972.html#L757'>phar</a>              757 ext/phar/zip.c 	phar-&gt;is_data = is_data;</span>
<span class='curline'><a href='../S/972.html#L759'>phar</a>              759 ext/phar/zip.c 	if (phar-&gt;is_zip) {</span>
<span class='curline'><a href='../S/972.html#L763'>phar</a>              763 ext/phar/zip.c 	if (phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/972.html#L764'>phar</a>              764 ext/phar/zip.c 		phar-&gt;internal_file_start = 0;</span>
<span class='curline'><a href='../S/972.html#L765'>phar</a>              765 ext/phar/zip.c 		phar-&gt;is_zip = 1;</span>
<span class='curline'><a href='../S/972.html#L766'>phar</a>              766 ext/phar/zip.c 		phar-&gt;is_tar = 0;</span>
<span class='curline'><a href='../S/972.html#L812'>phar</a>              812 ext/phar/zip.c 	phar_add_virtual_dirs(entry-&gt;phar, entry-&gt;filename, entry-&gt;filename_len);</span>
<span class='curline'><a href='../S/972.html#L857'>phar</a>              857 ext/phar/zip.c 			if (entry-&gt;fp_type == PHAR_MOD &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;fp &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/972.html#L866'>phar</a>              866 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to open file contents of file \"%s\" in zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L877'>phar</a>              877 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to seek to start of file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L904'>phar</a>              904 ext/phar/zip.c 				spprintf(p-&gt;error, 0, "unable to gzip compress file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L906'>phar</a>              906 ext/phar/zip.c 				spprintf(p-&gt;error, 0, "unable to bzip2 compress file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L917'>phar</a>              917 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to create temporary file for file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L924'>phar</a>              924 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to seek to start of file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L931'>phar</a>              931 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to copy compressed file contents of file \"%s\" while creating new phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L954'>phar</a>              954 ext/phar/zip.c 				spprintf(p-&gt;error, 0, "unable to seek to start of file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L981'>phar</a>              981 ext/phar/zip.c 		spprintf(p-&gt;error, 0, "unable to write local file header of file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L986'>phar</a>              986 ext/phar/zip.c 		spprintf(p-&gt;error, 0, "unable to write central directory entry for file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L992'>phar</a>              992 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to local directory entry for directory \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L997'>phar</a>              997 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to local directory entry for directory \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1002'>phar</a>             1002 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to central directory entry for directory \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1007'>phar</a>             1007 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to central directory entry for directory \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1012'>phar</a>             1012 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to local directory entry for file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1017'>phar</a>             1017 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write filename to central directory entry for file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1023'>phar</a>             1023 ext/phar/zip.c 		spprintf(p-&gt;error, 0, "unable to write local extra permissions file header of file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1028'>phar</a>             1028 ext/phar/zip.c 		spprintf(p-&gt;error, 0, "unable to write central extra permissions file header of file \"%s\" to zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1035'>phar</a>             1035 ext/phar/zip.c 				spprintf(p-&gt;error, 0, "unable to write compressed contents of file \"%s\" in zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1049'>phar</a>             1049 ext/phar/zip.c 				spprintf(p-&gt;error, 0, "unable to write contents of file \"%s\" in zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1054'>phar</a>             1054 ext/phar/zip.c 		if (entry-&gt;fp_type == PHAR_MOD &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;fp &amp;&amp; entry-&gt;fp != entry-&gt;phar-&gt;ufp &amp;&amp; entry-&gt;fp_refcount == 0) {</span>
<span class='curline'><a href='../S/972.html#L1075'>phar</a>             1075 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to copy contents of file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1086'>phar</a>             1086 ext/phar/zip.c 			spprintf(p-&gt;error, 0, "unable to write metadata as file comment for file \"%s\" while creating zip-based phar \"%s\"", entry-&gt;filename, entry-&gt;phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1104'>phar</a>             1104 ext/phar/zip.c static int phar_zip_applysignature(phar_archive_data *phar, struct _phar_zip_pass *pass,</span>
<span class='curline'><a href='../S/972.html#L1108'>phar</a>             1108 ext/phar/zip.c 	if (!phar-&gt;is_data || phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/972.html#L1131'>phar</a>             1131 ext/phar/zip.c 		if (FAILURE == phar_create_signature(phar, newfile, &amp;signature, &amp;signature_length, pass-&gt;error)) {</span>
<span class='curline'><a href='../S/972.html#L1152'>phar</a>             1152 ext/phar/zip.c 		PHAR_SET_32(sigbuf, phar-&gt;sig_flags);</span>
<span class='curline'><a href='../S/972.html#L1158'>phar</a>             1158 ext/phar/zip.c 				spprintf(pass-&gt;error, 0, "phar error: unable to write signature to zip-based phar %s", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1167'>phar</a>             1167 ext/phar/zip.c 		entry.phar = phar;</span>
<span class='curline'><a href='../S/972.html#L1182'>phar</a>             1182 ext/phar/zip.c int phar_zip_flush(phar_archive_data *phar, char *user_stub, zend_long len, int defaultstub, char **error) /* {{{ */</span>
<span class='curline'><a href='../S/972.html#L1204'>phar</a>             1204 ext/phar/zip.c 	entry.phar = phar;</span>
<span class='curline'><a href='../S/972.html#L1207'>phar</a>             1207 ext/phar/zip.c 	if (phar-&gt;is_persistent) {</span>
<span class='curline'><a href='../S/972.html#L1209'>phar</a>             1209 ext/phar/zip.c 			spprintf(error, 0, "internal error: attempt to flush cached zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1214'>phar</a>             1214 ext/phar/zip.c 	if (phar-&gt;is_data) {</span>
<span class='curline'><a href='../S/972.html#L1219'>phar</a>             1219 ext/phar/zip.c 	if (!phar-&gt;is_temporary_alias &amp;&amp; phar-&gt;alias_len) {</span>
<span class='curline'><a href='../S/972.html#L1225'>phar</a>             1225 ext/phar/zip.c 		if (phar-&gt;alias_len != (int)php_stream_write(entry.fp, phar-&gt;alias, phar-&gt;alias_len)) {</span>
<span class='curline'><a href='../S/972.html#L1227'>phar</a>             1227 ext/phar/zip.c 				spprintf(error, 0, "unable to set alias in zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1232'>phar</a>             1232 ext/phar/zip.c 		entry.uncompressed_filesize = entry.compressed_filesize = phar-&gt;alias_len;</span>
<span class='curline'><a href='../S/972.html#L1236'>phar</a>             1236 ext/phar/zip.c 		if (NULL == zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/972.html#L1238'>phar</a>             1238 ext/phar/zip.c 				spprintf(error, 0, "unable to set alias in zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1243'>phar</a>             1243 ext/phar/zip.c 		zend_hash_str_del(&amp;phar-&gt;manifest, ".phar/alias.txt", sizeof(".phar/alias.txt")-1);</span>
<span class='curline'><a href='../S/972.html#L1247'>phar</a>             1247 ext/phar/zip.c 	if (phar-&gt;alias_len) {</span>
<span class='curline'><a href='../S/972.html#L1248'>phar</a>             1248 ext/phar/zip.c 		if (FAILURE == phar_get_archive(&amp;phar, phar-&gt;fname, phar-&gt;fname_len, phar-&gt;alias, phar-&gt;alias_len, error)) {</span>
<span class='curline'><a href='../S/972.html#L1259'>phar</a>             1259 ext/phar/zip.c 					spprintf(error, 0, "unable to access resource to copy stub to new zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1288'>phar</a>             1288 ext/phar/zip.c 					spprintf(error, 0, "unable to read resource to copy stub to new zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1301'>phar</a>             1301 ext/phar/zip.c 				spprintf(error, 0, "illegal stub for zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1322'>phar</a>             1322 ext/phar/zip.c 				spprintf(error, 0, "unable to create stub from string in new zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1334'>phar</a>             1334 ext/phar/zip.c 		if (NULL == zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/972.html#L1339'>phar</a>             1339 ext/phar/zip.c 				spprintf(error, 0, "unable to set stub in zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1357'>phar</a>             1357 ext/phar/zip.c 				spprintf(error, 0, "unable to %s stub in%szip-based phar \"%s\", failed", user_stub ? "overwrite" : "create", user_stub ? " " : " new ", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1367'>phar</a>             1367 ext/phar/zip.c 			if (!zend_hash_str_exists(&amp;phar-&gt;manifest, ".phar/stub.php", sizeof(".phar/stub.php")-1)) {</span>
<span class='curline'><a href='../S/972.html#L1368'>phar</a>             1368 ext/phar/zip.c 				if (NULL == zend_hash_str_add_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/972.html#L1372'>phar</a>             1372 ext/phar/zip.c 						spprintf(error, 0, "unable to create stub in zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1381'>phar</a>             1381 ext/phar/zip.c 			if (NULL == zend_hash_str_update_mem(&amp;phar-&gt;manifest, entry.filename, entry.filename_len, (void*)&amp;entry, sizeof(phar_entry_info))) {</span>
<span class='curline'><a href='../S/972.html#L1385'>phar</a>             1385 ext/phar/zip.c 					spprintf(error, 0, "unable to overwrite stub in zip-based phar \"%s\"", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1392'>phar</a>             1392 ext/phar/zip.c 	if (phar-&gt;fp &amp;&amp; !phar-&gt;is_brandnew) {</span>
<span class='curline'><a href='../S/972.html#L1393'>phar</a>             1393 ext/phar/zip.c 		oldfile = phar-&gt;fp;</span>
<span class='curline'><a href='../S/972.html#L1397'>phar</a>             1397 ext/phar/zip.c 		oldfile = php_stream_open_wrapper(phar-&gt;fname, "rb", 0, NULL);</span>
<span class='curline'><a href='../S/972.html#L1411'>phar</a>             1411 ext/phar/zip.c 			spprintf(error, 4096, "phar zip flush of \"%s\" failed: unable to open temporary file", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1426'>phar</a>             1426 ext/phar/zip.c 	if (!phar-&gt;is_data &amp;&amp; !phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/972.html#L1427'>phar</a>             1427 ext/phar/zip.c 		phar-&gt;sig_flags = PHAR_SIG_SHA1;</span>
<span class='curline'><a href='../S/972.html#L1429'>phar</a>             1429 ext/phar/zip.c 	if (phar-&gt;sig_flags) {</span>
<span class='curline'><a href='../S/972.html#L1430'>phar</a>             1430 ext/phar/zip.c 		PHAR_SET_16(eocd.counthere, zend_hash_num_elements(&amp;phar-&gt;manifest) + 1);</span>
<span class='curline'><a href='../S/972.html#L1431'>phar</a>             1431 ext/phar/zip.c 		PHAR_SET_16(eocd.count, zend_hash_num_elements(&amp;phar-&gt;manifest) + 1);</span>
<span class='curline'><a href='../S/972.html#L1433'>phar</a>             1433 ext/phar/zip.c 		PHAR_SET_16(eocd.counthere, zend_hash_num_elements(&amp;phar-&gt;manifest));</span>
<span class='curline'><a href='../S/972.html#L1434'>phar</a>             1434 ext/phar/zip.c 		PHAR_SET_16(eocd.count, zend_hash_num_elements(&amp;phar-&gt;manifest));</span>
<span class='curline'><a href='../S/972.html#L1436'>phar</a>             1436 ext/phar/zip.c 	zend_hash_apply_with_argument(&amp;phar-&gt;manifest, phar_zip_changed_apply, (void *) &amp;pass);</span>
<span class='curline'><a href='../S/972.html#L1438'>phar</a>             1438 ext/phar/zip.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/972.html#L1441'>phar</a>             1441 ext/phar/zip.c 		php_var_serialize(&amp;main_metadata_str, &amp;phar-&gt;metadata, &amp;metadata_hash);</span>
<span class='curline'><a href='../S/972.html#L1446'>phar</a>             1446 ext/phar/zip.c 			spprintf(error, 4096, "phar zip flush of \"%s\" failed: %s", phar-&gt;fname, temperr);</span>
<span class='curline'><a href='../S/972.html#L1452'>phar</a>             1452 ext/phar/zip.c 		if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/972.html#L1462'>phar</a>             1462 ext/phar/zip.c 	if (FAILURE == phar_zip_applysignature(phar, &amp;pass, &amp;main_metadata_str)) {</span>
<span class='curline'><a href='../S/972.html#L1478'>phar</a>             1478 ext/phar/zip.c 				spprintf(error, 4096, "phar zip flush of \"%s\" failed: unable to write central-directory", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1486'>phar</a>             1486 ext/phar/zip.c 	if (Z_TYPE(phar-&gt;metadata) != IS_UNDEF) {</span>
<span class='curline'><a href='../S/972.html#L1492'>phar</a>             1492 ext/phar/zip.c 				spprintf(error, 4096, "phar zip flush of \"%s\" failed: unable to write end of central-directory", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1499'>phar</a>             1499 ext/phar/zip.c 				spprintf(error, 4096, "phar zip flush of \"%s\" failed: unable to write metadata to zip comment", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1509'>phar</a>             1509 ext/phar/zip.c 				spprintf(error, 4096, "phar zip flush of \"%s\" failed: unable to write end of central-directory", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1515'>phar</a>             1515 ext/phar/zip.c 	if (phar-&gt;fp &amp;&amp; pass.free_fp) {</span>
<span class='curline'><a href='../S/972.html#L1516'>phar</a>             1516 ext/phar/zip.c 		php_stream_close(phar-&gt;fp);</span>
<span class='curline'><a href='../S/972.html#L1519'>phar</a>             1519 ext/phar/zip.c 	if (phar-&gt;ufp) {</span>
<span class='curline'><a href='../S/972.html#L1521'>phar</a>             1521 ext/phar/zip.c 			php_stream_close(phar-&gt;ufp);</span>
<span class='curline'><a href='../S/972.html#L1523'>phar</a>             1523 ext/phar/zip.c 		phar-&gt;ufp = NULL;</span>
<span class='curline'><a href='../S/972.html#L1527'>phar</a>             1527 ext/phar/zip.c 	phar-&gt;is_brandnew = 0;</span>
<span class='curline'><a href='../S/972.html#L1529'>phar</a>             1529 ext/phar/zip.c 	if (phar-&gt;donotflush) {</span>
<span class='curline'><a href='../S/972.html#L1531'>phar</a>             1531 ext/phar/zip.c 		phar-&gt;fp = pass.filefp;</span>
<span class='curline'><a href='../S/972.html#L1533'>phar</a>             1533 ext/phar/zip.c 		phar-&gt;fp = php_stream_open_wrapper(phar-&gt;fname, "w+b", IGNORE_URL|STREAM_MUST_SEEK|REPORT_ERRORS, NULL);</span>
<span class='curline'><a href='../S/972.html#L1534'>phar</a>             1534 ext/phar/zip.c 		if (!phar-&gt;fp) {</span>
<span class='curline'><a href='../S/972.html#L1538'>phar</a>             1538 ext/phar/zip.c 			phar-&gt;fp = pass.filefp;</span>
<span class='curline'><a href='../S/972.html#L1540'>phar</a>             1540 ext/phar/zip.c 				spprintf(error, 4096, "unable to open new phar \"%s\" for writing", phar-&gt;fname);</span>
<span class='curline'><a href='../S/972.html#L1545'>phar</a>             1545 ext/phar/zip.c 		php_stream_copy_to_stream_ex(pass.filefp, phar-&gt;fp, PHP_STREAM_COPY_ALL, NULL);</span>
</pre>
</body>
</html>
